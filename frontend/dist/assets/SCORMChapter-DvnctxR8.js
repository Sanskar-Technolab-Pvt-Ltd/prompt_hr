import{s as G,Z as x,i as P,r as T,$ as V,a0 as D,c as R,y as I,a as k,u as B,d as l,e as i,f as c,j as F,g as v,k as a,t as C,m as j,n as z,_ as A,F as q,Y as O}from"./index-OSkjyhkw.js";import{_ as Y}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DdVHL6EX.js";const Z={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},H={key:0},J=["src"],K={key:1},Q={class:"text-center pt-10 px-5 md:px-0 pb-10"},U={class:"text-center"},W={class:"mb-4"},te={__name:"SCORMChapter",props:{courseName:{type:String,required:!0},chapterName:{type:String,required:!0}},setup(L){var S,f;const{brand:M}=G(),N=x(),o=P("$user"),m=T(!1),r=L;V(()=>{N.isSidebarCollapsed=!0,y()});const t=D({doctype:"Course Chapter",name:r.chapterName,auto:!0,cache:["chapter",r.chapterName],onSuccess(e){_.submit()}}),u=R({doctype:"LMS Enrollment",fields:["member","course"],filters:{course:r.courseName,member:(S=o.data)==null?void 0:S.name},auto:!0,cache:["enrollments",r.courseName,(f=o.data)==null?void 0:f.name]}),d=e=>{var s;return e=="cmi.core.lesson_status"?((s=_.data)==null?void 0:s.status)=="Complete"?"passed":"incomplete":""},p=(e,s)=>{e=="cmi.core.lesson_status"&&s=="passed"&&$()},$=()=>{O("lms.lms.doctype.course_lesson.course_lesson.save_progress",{lesson:t.doc.lessons[0].lesson,course:r.courseName})},_=I({url:"frappe.client.get_value",makeParams(e){var s,n;return{doctype:"LMS Course Progress",fieldname:"status",filters:{member:(s=o.data)==null?void 0:s.name,lesson:t.doc.lessons[0].lesson,chapter:t.doc.name,course:(n=t.doc)==null?void 0:n.course}}},onSuccess(e){m.value=!0}}),w=()=>{var e;u.insert.submit({course:r.courseName,member:(e=o.data)==null?void 0:e.name},{onSuccess(s){window.location.reload()}})},y=()=>{window.API_1484_11={Initialize:()=>"true",Terminate:()=>"true",GetValue:e=>(console.log(`GET: ${e}`),d(e)),SetValue:(e,s)=>(console.log(`SET: ${e} to value: ${s}`),p(e,s),"true"),Commit:()=>"true",GetLastError:()=>"0",GetErrorString:()=>"",GetDiagnostic:()=>""},window.API={LMSInitialize:()=>"true",LMSFinish:()=>"true",LMSGetValue:e=>(console.log(`GET: ${e}`),d(e)),LMSSetValue:(e,s)=>(console.log(`SET: ${e} to value: ${s}`),p(e,s),"true"),LMSCommit:()=>"true",LMSGetLastError:()=>"0",LMSGetErrorString:()=>"",LMSGetDiagnostic:()=>""}},E=k(()=>{var e,s;return[{label:"Courses",route:{name:"Courses"}},{label:(e=t.doc)==null?void 0:e.course_title,route:{name:"CourseDetail",params:{courseName:r.courseName}}},{label:(s=t.doc)==null?void 0:s.title}]});return B(()=>{var e;return{title:(e=t.doc)==null?void 0:e.title,icon:M.favicon}}),(e,s)=>{var n,h,g,b;return i(),l(q,null,[c("header",Z,[v(a(Y),{class:"h-7",items:E.value},null,8,["items"])]),m.value&&((n=a(u).data)!=null&&n.length||(h=a(o).data)!=null&&h.is_moderator||(g=a(o).data)!=null&&g.is_instructor)?(i(),l("div",H,[c("iframe",{src:a(t).doc.launch_file,class:"w-full h-screen"},null,8,J)])):(b=a(u).data)!=null&&b.length?F("",!0):(i(),l("div",K,[c("div",Q,[c("div",U,[c("div",W,C(e.__("You are not enrolled in this course. Please enroll to access this lesson.")),1),v(a(A),{variant:"solid",onClick:s[0]||(s[0]=X=>w())},{default:j(()=>[z(C(e.__("Start Learning")),1)]),_:1})])])]))],64)}}};export{te as default};
