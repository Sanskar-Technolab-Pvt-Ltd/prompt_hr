import{a9 as K,a as U,o as oe,aV as re,r as $,ba as me,bz as fe,bu as T,bv as X,bA as B,bp as ne,bS as ge,bT as F,bD as G,by as Z,bU as _e,bx as ee,i as A,D as ke,E as te,ai as ve,H as be,y as M,w as he,h as k,e as u,m as y,f as v,g as x,d as L,j as h,k as o,p as ye,ax as Ce,b1 as xe,_ as H,n as z,t as O,b2 as ie,b3 as Se,b4 as De,J as we,A as D,C as Ee,R as $e,x as Oe,ae as Pe,b as Ne,L as I,F as ae,v as Ve,X as Me,N as se,bV as Le,be as q,ac as le,bW as Te,bX as Be,bh as Ie,M as Re}from"./index-OSkjyhkw.js";import{D as ze}from"./vuedraggable.umd-Qkpg2qlG.js";var Ue=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ue||{});let ue=Symbol("DisclosureContext");function J(e){let f=A(ue,null);if(f===null){let b=new Error(`<${e} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(b,J),b}return f}let ce=Symbol("DisclosurePanelContext");function Fe(){return A(ce,null)}let Ae=K({name:"Disclosure",props:{as:{type:[Object,String],default:"template"},defaultOpen:{type:[Boolean],default:!1}},setup(e,{slots:f,attrs:b}){let g=$(e.defaultOpen?0:1),a=$(null),_=$(null),t={buttonId:$(`headlessui-disclosure-button-${Z()}`),panelId:$(`headlessui-disclosure-panel-${Z()}`),disclosureState:g,panel:a,button:_,toggleDisclosure(){g.value=ee(g.value,{0:1,1:0})},closeDisclosure(){g.value!==1&&(g.value=1)},close(i){t.closeDisclosure();let p=i?i instanceof HTMLElement?i:i.value instanceof HTMLElement?T(i):T(t.button):T(t.button);p==null||p.focus()}};return ne(ue,t),_e(U(()=>ee(g.value,{0:F.Open,1:F.Closed}))),()=>{let{defaultOpen:i,...p}=e,m={open:g.value===0,close:t.close};return X({theirProps:p,ourProps:{},slot:m,slots:f,attrs:b,name:"Disclosure"})}}}),je=K({name:"DisclosureButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},setup(e,{attrs:f,slots:b,expose:g}){let a=J("DisclosureButton"),_=Fe(),t=U(()=>_===null?!1:_.value===a.panelId.value);oe(()=>{t.value||e.id!==null&&(a.buttonId.value=e.id)}),re(()=>{t.value||(a.buttonId.value=null)});let i=$(null);g({el:i,$el:i}),t.value||me(()=>{a.button.value=i.value});let p=fe(U(()=>({as:e.as,type:f.type})),i);function m(){var d;e.disabled||(t.value?(a.toggleDisclosure(),(d=T(a.button))==null||d.focus()):a.toggleDisclosure())}function w(d){var E;if(!e.disabled)if(t.value)switch(d.key){case B.Space:case B.Enter:d.preventDefault(),d.stopPropagation(),a.toggleDisclosure(),(E=T(a.button))==null||E.focus();break}else switch(d.key){case B.Space:case B.Enter:d.preventDefault(),d.stopPropagation(),a.toggleDisclosure();break}}function P(d){switch(d.key){case B.Space:d.preventDefault();break}}return()=>{var d;let E={open:a.disclosureState.value===0},{id:l,...r}=e,n=t.value?{ref:i,type:p.value,onClick:m,onKeydown:w}:{id:(d=a.buttonId.value)!=null?d:l,ref:i,type:p.value,"aria-expanded":a.disclosureState.value===0,"aria-controls":a.disclosureState.value===0||T(a.panel)?a.panelId.value:void 0,disabled:e.disabled?!0:void 0,onClick:m,onKeydown:w,onKeyup:P};return X({ourProps:n,theirProps:r,slot:E,attrs:f,slots:b,name:"DisclosureButton"})}}}),qe=K({name:"DisclosurePanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null}},setup(e,{attrs:f,slots:b,expose:g}){let a=J("DisclosurePanel");oe(()=>{e.id!==null&&(a.panelId.value=e.id)}),re(()=>{a.panelId.value=null}),g({el:a.panel,$el:a.panel}),ne(ce,a.panelId);let _=ge(),t=U(()=>_!==null?(_.value&F.Open)===F.Open:a.disclosureState.value===0);return()=>{var i;let p={open:a.disclosureState.value===0,close:a.close},{id:m,...w}=e,P={id:(i=a.panelId.value)!=null?i:m,ref:a.panel};return X({ourProps:P,theirProps:w,slot:p,attrs:f,slots:b,features:G.RenderStrategy|G.Static,visible:t.value,name:"DisclosurePanel"})}}});const He={class:"space-y-4 text-base"},Ke={key:0},Xe={class:"mb-4"},Je={key:1,class:""},Qe={class:"flex items-center"},We={class:"border rounded-md p-2 mr-2"},Ye={class:"flex flex-col"},Ge={class:"text-sm text-ink-gray-4 mt-1"},Ze={__name:"ChapterModal",props:ke({course:{type:String,required:!0},chapterDetail:{type:Object}},{modelValue:{},modelModifiers:{},outline:{},outlineModifiers:{}}),emits:["update:modelValue","update:outline"],setup(e){const f=te(e,"modelValue"),b=te(e,"outline"),g=A("$user"),{updateOnboardingStep:a}=ve("learning"),_=e,t=be({title:"",is_scorm_package:0,scorm_package:null}),i=M({url:"lms.lms.api.upsert_chapter",makeParams(l){var r;return{title:t.title,course:_.course,is_scorm_package:t.is_scorm_package,scorm_package:t.scorm_package,name:(r=_.chapterDetail)==null?void 0:r.name}}}),p=M({url:"frappe.client.insert",makeParams(l){return{doc:{doctype:"Chapter Reference",chapter:l.name,parent:_.course,parenttype:"LMS Course",parentfield:"chapters"}}}}),m=async l=>{i.submit({},{validate(){return w()},onSuccess:r=>{var n;(n=g.data)!=null&&n.is_system_manager&&a("create_first_chapter"),Ee("chapter_created"),p.submit({name:r.name},{onSuccess(N){P(),b.value.reload(),D(__("Success"),__("Chapter added successfully"),"check")},onError(N){var V;D(__("Error"),((V=N.messages)==null?void 0:V[0])||N,"x")}}),l()},onError(r){var n;D(__("Error"),((n=r.messages)==null?void 0:n[0])||r,"x")}})},w=()=>{if(!t.title)return __("Title is required");if(t.is_scorm_package&&!t.scorm_package)return __("Please upload a SCORM package")},P=()=>{t.title="",t.is_scorm_package=0,t.scorm_package=null},d=l=>{i.submit({},{validate(){if(!t.title)return"Title is required"},onSuccess(){b.value.reload(),D(__("Success"),__("Chapter updated successfully"),"check"),l()},onError(r){var n;D(__("Error"),((n=r.messages)==null?void 0:n[0])||r,"x")}})};he(()=>_.chapterDetail,l=>{t.title=l==null?void 0:l.title,t.is_scorm_package=l==null?void 0:l.is_scorm_package,t.scorm_package=l==null?void 0:l.scorm_package});const E=l=>{if(l.name.split(".").pop().toLowerCase()!=="zip")return __("Only zip files are allowed")};return(l,r)=>(u(),k(o(we),{modelValue:f.value,"onUpdate:modelValue":r[4]||(r[4]=n=>f.value=n),options:{title:e.chapterDetail?l.__("Edit Chapter"):l.__("Add Chapter"),size:"lg",actions:[{label:e.chapterDetail?l.__("Edit"):l.__("Create"),variant:"solid",onClick:n=>e.chapterDetail?d(n):m(n)}]}},{"body-content":y(()=>[v("div",He,[x(o(ye),{label:"Title",modelValue:t.title,"onUpdate:modelValue":r[0]||(r[0]=n=>t.title=n),required:!0},null,8,["modelValue"]),x(o(Ce),{size:"sm",label:l.__("SCORM Package"),description:l.__("Enable this only if you want to upload a SCORM package as a chapter."),modelValue:t.is_scorm_package,"onUpdate:modelValue":r[1]||(r[1]=n=>t.is_scorm_package=n)},null,8,["label","description","modelValue"]),t.is_scorm_package?(u(),L("div",Ke,[t.scorm_package?(u(),L("div",Je,[v("div",Qe,[v("div",We,[x(o(ie),{class:"h-5 w-5 stroke-1.5 text-ink-gray-7"})]),v("div",Ye,[v("span",null,O(t.scorm_package.file_name),1),v("span",Ge,O(o(Se)(t.scorm_package.file_size)),1)]),x(o(De),{onClick:r[3]||(r[3]=()=>t.scorm_package=null),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(u(),k(o(xe),{key:0,fileTypes:[".zip"],validateFile:E,onSuccess:r[2]||(r[2]=n=>t.scorm_package=n)},{default:y(({file:n,progress:N,uploading:V,openFileSelector:j})=>[v("div",Xe,[x(o(H),{onClick:j,loading:V},{default:y(()=>[z(O(V?`Uploading ${N}%`:"Upload an zip file"),1)]),_:2},1032,["onClick","loading"])])]),_:1}))])):h("",!0)])]),_:1},8,["modelValue","options"]))}},et={class:"h-full"},tt=["onClick"],at={class:"flex ml-auto space-x-4"},st={class:"flex items-center text-sm leading-5 group"},lt={key:1,class:"flex mt-2 mb-4 pl-8"},it={__name:"CourseOutline",props:{courseName:{type:String,required:!0},showOutline:{type:Boolean,default:!1},title:{type:String,default:""},allowEdit:{type:Boolean,default:!1},getProgress:{type:Boolean,default:!1}},setup(e){const f=$e(),b=Oe(),g=A("$user"),a=$(!1),_=$(null),t=Pe(),{$dialog:i}=t.appContext.config.globalProperties,p=e,m=M({url:"lms.lms.utils.get_course_outline",cache:["course_outline",p.courseName],params:{course:p.courseName,progress:p.getProgress},auto:!0}),w=M({url:"lms.lms.api.delete_lesson",makeParams(s){return{lesson:s.lesson,chapter:s.chapter}},onSuccess(){m.reload(),D("Success","Lesson deleted successfully","check")}}),P=M({url:"lms.lms.api.update_lesson_index",makeParams(s){return{lesson:s.lesson,sourceChapter:s.sourceChapter,targetChapter:s.targetChapter,idx:s.idx}},onSuccess(){D("Success","Lesson moved successfully","check")}}),d=(s,S)=>{i({title:__("Delete this lesson?"),message:__("Deleting this lesson will permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(R){w.submit({lesson:s,chapter:S}),R()}}]})},E=s=>s==f.params.chapterNumber||s==1,l=(s=null)=>{_.value=s,a.value=!0},r=()=>_.value,n=s=>{P.submit({lesson:s.item.__draggable_context.element.name,sourceChapter:s.from.dataset.chapter,targetChapter:s.to.dataset.chapter,idx:s.newIndex})},N=M({url:"lms.lms.api.delete_chapter",makeParams(s){return{chapter:s.chapter}},onSuccess(){m.reload(),D("Success","Chapter deleted successfully","check")}}),V=s=>{i({title:__("Delete this chapter?"),message:__("Deleting this chapter will also delete all its lessons and permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(S){N.submit({chapter:s}),S()}}]})},j=s=>{if(s.is_scorm_package&&(event.preventDefault(),!p.allowEdit)){if(!g.data){D(__("You are not enrolled"),__("Please enroll for this course to view this lesson"),"alert-circle");return}b.push({name:"SCORMChapter",params:{courseName:p.courseName,chapterName:s.name}})}},de=s=>f.params.chapterNumber==s.split(".")[0]&&f.params.lessonNumber==s.split(".")[1];return(s,S)=>{var Q,W;const R=Ne("router-link");return u(),L(ae,null,[v("div",et,[e.title&&((Q=o(m).data)!=null&&Q.length||e.allowEdit)?(u(),L("div",{key:0,class:I(["flex items-center justify-between space-x-2 mb-4 px-2",{"sticky top-0 z-10 bg-surface-white border-b px-3 py-2.5 sm:px-5":e.allowEdit}])},[v("div",{class:I(["font-semibold text-lg leading-5 text-ink-gray-9",{"font-medium text-p-base":e.allowEdit}])},O(s.__(e.title)),3),e.allowEdit?(u(),k(o(H),{key:0,size:"sm",onClick:S[0]||(S[0]=c=>l())},{default:y(()=>[z(O(s.__("Add Chapter")),1)]),_:1})):h("",!0)],2)):h("",!0),v("div",{class:I({"border-2 rounded-md py-2 px-2":e.showOutline&&((W=o(m).data)==null?void 0:W.length)})},[(u(!0),L(ae,null,Ve(o(m).data,(c,pe)=>(u(),k(o(Ae),{key:c.name,defaultOpen:E(c.idx)},{default:y(({open:Y})=>[x(o(je),{ref_for:!0,ref:"",class:"flex items-center w-full p-2 group"},{default:y(()=>[x(o(Me),{class:I([{"rotate-90 transform duration-200":Y,"duration-200":!Y,hidden:c.is_scorm_package,open:pe==1},"h-4 w-4 text-ink-gray-9 stroke-1"])},null,8,["class"]),v("div",{class:"text-base text-left text-ink-gray-9 font-medium leading-5 ml-2",onClick:C=>j(c)},O(c.title),9,tt),v("div",at,[x(o(se),{text:s.__("Edit Chapter"),placement:"bottom"},{default:y(()=>[e.allowEdit?(u(),k(o(Le),{key:0,onClick:q(C=>l(c),["prevent"]),class:"h-4 w-4 text-ink-gray-9 invisible group-hover:visible"},null,8,["onClick"])):h("",!0)]),_:2},1032,["text"]),x(o(se),{text:s.__("Delete Chapter"),placement:"bottom"},{default:y(()=>[e.allowEdit?(u(),k(o(le),{key:0,onClick:q(C=>V(c.name),["prevent"]),class:"h-4 w-4 text-ink-red-3 invisible group-hover:visible"},null,8,["onClick"])):h("",!0)]),_:2},1032,["text"])])]),_:2},1536),c.is_scorm_package?h("",!0):(u(),k(o(qe),{key:0},{default:y(()=>[c.is_scorm_package?h("",!0):(u(),k(o(ze),{key:0,list:c.lessons,disabled:!e.allowEdit,"item-key":"name",group:"items",onEnd:n,"data-chapter":c.name},{item:y(({element:C})=>[v("div",{class:I(["outline-lesson pl-8 py-2 pr-4 text-ink-gray-9",de(C.number)?"bg-surface-gray-3":""])},[x(R,{to:{name:e.allowEdit?"LessonForm":"Lesson",params:{courseName:e.courseName,chapterNumber:C.number.split(".")[0],lessonNumber:C.number.split(".")[1]}}},{default:y(()=>[v("div",st,[C.icon==="icon-youtube"?(u(),k(o(Te),{key:0,class:"h-4 w-4 stroke-1 mr-2"})):C.icon==="icon-quiz"?(u(),k(o(Be),{key:1,class:"h-4 w-4 stroke-1 mr-2"})):C.icon==="icon-list"?(u(),k(o(ie),{key:2,class:"h-4 w-4 text-ink-gray-9 stroke-1 mr-2"})):h("",!0),z(" "+O(C.title)+" ",1),e.allowEdit?(u(),k(o(le),{key:3,onClick:q(ot=>d(C.name,c.name),["prevent"]),class:"h-4 w-4 text-ink-red-3 ml-auto invisible group-hover:visible"},null,8,["onClick"])):h("",!0),C.is_complete?(u(),k(o(Ie),{key:4,class:"h-4 w-4 text-green-700 ml-2"})):h("",!0)])]),_:2},1032,["to"])],2)]),_:2},1032,["list","disabled","data-chapter"])),e.allowEdit?(u(),L("div",lt,[c.is_scorm_package?h("",!0):(u(),k(R,{key:0,to:{name:"LessonForm",params:{courseName:e.courseName,chapterNumber:c.idx,lessonNumber:c.lessons.length+1}}},{default:y(()=>[x(o(H),null,{default:y(()=>[z(O(s.__("Add Lesson")),1)]),_:1})]),_:2},1032,["to"]))])):h("",!0)]),_:2},1024))]),_:2},1032,["defaultOpen"]))),128))],2)]),o(g).data?(u(),k(Ze,{key:0,modelValue:a.value,"onUpdate:modelValue":S[1]||(S[1]=c=>a.value=c),outline:o(m),"onUpdate:outline":S[2]||(S[2]=c=>Re(m)?m.value=c:null),course:e.courseName,chapterDetail:r()},null,8,["modelValue","outline","course","chapterDetail"])):h("",!0)],64)}}};export{it as _};
