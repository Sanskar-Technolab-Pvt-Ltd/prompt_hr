import{D as B,i as C,E as j,H as N,y as D,w as P,h as k,e as c,m as u,f as l,d as v,j as x,g as r,t as i,k as e,q as T,p as A,F as S,v as U,L,a2 as Y,J as R,K as z,r as q,ae as F,n as $,_ as V,aK as G,aL as H,aM as J,aN as K,aO as I,aP as O,aQ as Q,an as W,a1 as X,G as Z,aR as ee,M as te,Y as ae}from"./index-OSkjyhkw.js";const se={class:"flex flex-col gap-4"},le={class:"mb-1.5 text-sm text-ink-gray-5"},oe={class:"mb-1.5 text-sm text-ink-gray-5"},ne={key:0},ie={class:"mb-1.5 text-sm text-ink-gray-5"},re={class:"grid grid-cols-2 gap-2"},de=["onClick"],ce={key:1,class:"text-sm italic text-ink-red-4"},ue={__name:"EvaluationModal",props:B({courses:{type:Array,default:[]},batch:{type:String,default:null},endDate:{type:String,default:null}},{modelValue:{},modelModifiers:{},reloadEvals:{},reloadEvalsModifiers:{}}),emits:["update:modelValue","update:reloadEvals"],setup(_){const y=C("$user"),f=C("$dayjs"),h=j(_,"modelValue"),w=j(_,"reloadEvals"),p=_;let a=N({course:"",date:"",start_time:"",end_time:"",day:"",batch:p.batch,member:y.data.name});const m=D({url:"frappe.client.insert",makeParams(t){return{doc:{doctype:"LMS Certificate Request",batch_name:t.batch,...t}}}});function E(t){m.submit(a,{validate(){if(!a.course)return"Please select a course.";if(!a.date)return"Please select a date.";if(!a.start_time)return"Please select a slot.";if(f(a.date).isBefore(f(),"day"))return"Please select a future date.";if(f(a.date).isAfter(f(p.endDate),"day"))return`Please select a date before the end date ${f(p.endDate).format("DD MMMM YYYY")}.`},onSuccess(){w.value.reload(),t()},onError(o){var b;let n=((b=o.messages)==null?void 0:b[0])||o,s;typeof n=="string"?s=n==null?void 0:n.includes("unavailable"):s=!1,z({title:s?__("Evaluator is Unavailable"):"",text:n,icon:s?"alert-circle":"x",iconClasses:"bg-yellow-600 text-ink-white rounded-md p-px",position:"top-center",timeout:10})}})}const M=()=>{let t=[];for(const o of p.courses)o.evaluator&&t.push({label:o.title,value:o.course});return t.length==1&&(a.course=t[0].value),t},g=D({url:"lms.lms.doctype.course_evaluator.course_evaluator.get_schedule",makeParams(t){return{course:t.course,date:t.date,batch:p.batch}}});P(()=>a.date,t=>{a.start_time="",t&&a.course&&g.submit(a)}),P(()=>a.course,t=>{a.date="",a.start_time="",g.reset()});const d=t=>{a.start_time=t.start_time,a.end_time=t.end_time,a.day=t.day};return(t,o)=>(c(),k(e(R),{modelValue:h.value,"onUpdate:modelValue":o[2]||(o[2]=n=>h.value=n),options:{title:t.__("Schedule Evaluation"),size:"xl",actions:[{label:t.__("Submit"),variant:"solid",onClick:n=>E(n)}]}},{"body-content":u(()=>{var n;return[l("div",se,[l("div",null,[l("div",le,i(t.__("Course")),1),r(e(T),{modelValue:e(a).course,"onUpdate:modelValue":o[0]||(o[0]=s=>e(a).course=s),options:M()},null,8,["modelValue","options"])]),l("div",null,[l("div",oe,i(t.__("Date")),1),r(e(A),{type:"date",modelValue:e(a).date,"onUpdate:modelValue":o[1]||(o[1]=s=>e(a).date=s),min:e(f)().add(e(f).duration({days:1})).format("YYYY-MM-DD")},null,8,["modelValue","min"])]),(n=e(g).data)!=null&&n.length?(c(),v("div",ne,[l("div",ie,i(t.__("Select a slot")),1),l("div",re,[(c(!0),v(S,null,U(e(g).data,s=>(c(),v("div",null,[l("div",{class:L(["text-base text-center border rounded-md bg-surface-gray-3 p-2 cursor-pointer",{"border-gray-900":e(a).start_time==s.start_time}]),onClick:b=>d(s)},i(e(Y)(s.start_time))+" - "+i(e(Y)(s.end_time)),11,de)]))),256))])])):e(a).course&&e(a).date?(c(),v("div",ce,i(t.__("No slots available for this date.")),1)):x("",!0)])]}),_:1},8,["modelValue","options"]))}},me={class:"flex items-center justify-between mb-4"},_e={class:"text-lg font-semibold"},fe={key:0},ve={class:"grid grid-cols-3 gap-4"},pe={class:"border rounded-md p-3"},he={class:"flex justify-between mb-3"},ge={class:"font-semibold leading-5"},be={class:"flex items-center mb-2"},ye={class:"ml-2"},ke={class:"flex items-center mb-2"},xe={class:"ml-2"},Ce={class:"flex items-center"},we={class:"ml-2"},Ee={class:"flex items-center justify-between space-x-2 mt-4"},Me={key:1,class:"text-sm italic text-ink-gray-5"},De={__name:"UpcomingEvaluations",props:{batch:{type:String,default:null},courses:{type:Array,default:[]},endDate:{type:String,default:null}},setup(_){const y=C("$dayjs"),f=C("$user"),h=q(!1),w=F(),{$dialog:p}=w.appContext.config.globalProperties,a=_,m=D({url:"lms.lms.utils.get_upcoming_evals",params:{student:f.data.name,courses:a.courses.map(d=>d.course),batch:a.batch},auto:!0});function E(){h.value=!0}const M=d=>{window.open(d.google_meet_link,"_blank")},g=d=>{p({title:__("Cancel this evaluation?"),message:__("Are you sure you want to cancel this evaluation? This action cannot be undone."),actions:[{label:__("Cancel"),theme:"red",variant:"solid",onClick(t){ae("lms.lms.api.cancel_evaluation",{evaluation:d}).then(()=>{m.reload()}),t()}}]})};return(d,t)=>{var o,n;return c(),v(S,null,[l("div",null,[l("div",me,[l("div",_e,i(d.__("Upcoming Evaluations")),1),!((o=e(m).data)!=null&&o.length)||e(m).length==_.courses.length?(c(),k(e(V),{key:0,onClick:E},{default:u(()=>[$(i(d.__("Schedule Evaluation")),1)]),_:1})):x("",!0)]),(n=e(m).data)!=null&&n.length?(c(),v("div",fe,[l("div",ve,[(c(!0),v(S,null,U(e(m).data,s=>(c(),v("div",null,[l("div",pe,[l("div",he,[l("span",ge,i(s.course_title),1),s.date>e(y)().format()?(c(),k(e(Q),{key:0,as:"div",class:"relative inline-block text-left"},{default:u(()=>[l("div",null,[r(e(G),{class:"inline-flex w-full justify-center"},{default:u(()=>[r(e(H),{class:"w-4 h-4 stroke-1.5"})]),_:1})]),r(J,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:u(()=>[r(e(K),{class:"absolute mt-2 w-32 rounded-md bg-white shadow-lg p-1.5"},{default:u(()=>[r(e(I),null,{default:u(({active:b})=>[r(e(V),{variant:"ghost",class:"w-full",onClick:$e=>g(s)},{prefix:u(()=>[r(e(O),{active:b,class:"size-4 stroke-1.5","aria-hidden":"true"},null,8,["active"])]),default:u(()=>[$(" "+i(d.__("Cancel")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):x("",!0)]),l("div",be,[r(e(W),{class:"w-4 h-4 stroke-1.5"}),l("span",ye,i(e(y)(s.date).format("DD MMMM YYYY")),1)]),l("div",ke,[r(e(X),{class:"w-4 h-4 stroke-1.5"}),l("span",xe,i(e(Y)(s.start_time)),1)]),l("div",Ce,[r(e(Z),{class:"w-4 h-4 stroke-1.5"}),l("span",we,i(s.evaluator_name),1)]),l("div",Ee,[s.google_meet_link?(c(),k(e(V),{key:0,onClick:b=>M(s),class:"w-full"},{prefix:u(()=>[r(e(ee),{class:"w-4 h-4 stroke-1.5"})]),default:u(()=>[$(" "+i(d.__("Join Call")),1)]),_:2},1032,["onClick"])):x("",!0)])])]))),256))])])):(c(),v("div",Me,i(d.__("Please schedule an evaluation to get certified.")),1))]),r(ue,{batch:_.batch,endDate:_.endDate,courses:_.courses,modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=s=>h.value=s),reloadEvals:e(m),"onUpdate:reloadEvals":t[1]||(t[1]=s=>te(m)?m.value=s:null)},null,8,["batch","endDate","courses","modelValue","reloadEvals"])],64)}}};export{De as _};
