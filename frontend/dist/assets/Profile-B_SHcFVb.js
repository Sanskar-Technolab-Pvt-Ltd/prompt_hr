import{i as I,b as L,d as g,e as u,f as o,j as U,n as y,t as m,k as e,g as n,m as c,_ as C,D as z,E as A,H as q,y as V,b0 as H,w as R,h as P,b1 as N,b2 as O,b3 as D,b4 as J,p as E,aw as X,J as Y,A as G,r as F,b5 as K,F as B,v as Q,b6 as W,b7 as Z,b8 as ee,b9 as se,s as te,R as ae,x as oe,o as le,ay as re,ba as ie,a as ne,u as de,L as ue,bb as M,M as me}from"./index-OSkjyhkw.js";import{_ as ce}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DdVHL6EX.js";import{T as fe}from"./TabButtons-B08mECax.js";import{_ as pe}from"./UserAvatar-CL8ZQPT_.js";const _e={class:"border rounded-md w-1/3 mx-auto my-32"},be={class:"border-b px-5 py-3 font-medium"},ve={key:0,class:"px-5 py-3"},ge={class:"px-5 py-3"},he={__name:"NoPermission",setup($){const k=I("$user"),_=()=>{window.location.href="/login"};return(s,b)=>{const w=L("router-link");return u(),g("div",_e,[o("div",be,[b[1]||(b[1]=o("span",{class:"inline-flex items-center before:bg-surface-red-5 before:w-2 before:h-2 before:rounded-md before:mr-2"},null,-1)),y(" "+m(s.__("Not Permitted")),1)]),e(k).data?(u(),g("div",ve,[o("div",null,m(s.__("You do not have permission to access this page.")),1),n(w,{to:{name:"Courses"}},{default:c(()=>[n(e(C),{variant:"solid",class:"mt-2"},{default:c(()=>[y(m(s.__("Checkout Courses")),1)]),_:1})]),_:1})])):U("",!0),o("div",ge,[o("div",null,m(s.__("Please login to access this page.")),1),n(e(C),{onClick:b[0]||(b[0]=v=>_()),class:"mt-4"},{default:c(()=>[y(m(s.__("Login")),1)]),_:1})])])}}},xe={class:"mb-4"},ye={key:1,class:"mb-4"},ke={class:"text-xs text-ink-gray-5 mb-1"},we={class:"flex items-center"},$e={class:"border rounded-md p-2 mr-2"},Pe={class:"text-base flex flex-col"},Ce={class:"text-sm text-ink-gray-4 mt-1"},Se={class:"mb-4"},Ue={class:"mb-1.5 text-sm text-ink-gray-5"},Ve={__name:"EditProfile",props:z({profile:{type:Object,required:!0}},{reloadProfile:{},reloadProfileModifiers:{}}),emits:["update:reloadProfile"],setup($){const k=A($,"reloadProfile"),_=$,s=q({first_name:"",last_name:"",headline:"",bio:"",image:""}),b=V({url:"lms.lms.api.get_file_info",makeParams(a){return{file_url:a.image}},auto:!1,onSuccess(a){s.image=a}}),w=V({url:"frappe.client.set_value",makeParams(a){return s.bio=H(s.bio),{doctype:"User",name:_.profile.data.name,fieldname:{user_image:s.image.file_url,...s}}},onSuccess(a){_.profile.data=a}}),v=a=>{w.submit({},{onSuccess(){a(),k.value.reload()},onError(r){var d;G("Error",((d=r.messages)==null?void 0:d[0])||r,"x")}})},f=a=>{let r=a.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(r))return"Only image file is allowed."},h=a=>{s.image=a},t=()=>{s.image=null};return R(()=>_.profile.data,a=>{a&&(s.first_name=a.first_name,s.last_name=a.last_name,s.headline=a.headline,s.bio=a.bio,a.user_image&&b.submit({image:a.user_image}))}),(a,r)=>(u(),P(e(Y),{options:{title:"Edit your profile",size:"xl",actions:[{label:"Save",variant:"solid",onClick:d=>v(d)}]}},{"body-content":c(()=>[o("div",null,[s.image?(u(),g("div",ye,[o("div",ke,m(a.__("Profile Image")),1),o("div",we,[o("div",$e,[n(e(O),{class:"h-5 w-5 stroke-1.5 text-ink-gray-7"})]),o("div",Pe,[o("span",null,m(s.image.file_name),1),o("span",Ce,m(e(D)(s.image.file_size)),1)]),n(e(J),{onClick:r[1]||(r[1]=d=>t()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(u(),P(e(N),{key:0,fileTypes:["image/*"],validateFile:f,onSuccess:r[0]||(r[0]=d=>h(d))},{default:c(({file:d,progress:S,uploading:j,openFileSelector:T})=>[o("div",xe,[n(e(C),{onClick:T,loading:j},{default:c(()=>[y(m(j?`Uploading ${S}%`:"Upload a profile image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})),n(e(E),{modelValue:s.first_name,"onUpdate:modelValue":r[2]||(r[2]=d=>s.first_name=d),label:a.__("First Name"),class:"mb-4"},null,8,["modelValue","label"]),n(e(E),{modelValue:s.last_name,"onUpdate:modelValue":r[3]||(r[3]=d=>s.last_name=d),label:a.__("Last Name"),class:"mb-4"},null,8,["modelValue","label"]),n(e(E),{modelValue:s.headline,"onUpdate:modelValue":r[4]||(r[4]=d=>s.headline=d),label:a.__("Headline"),class:"mb-4"},null,8,["modelValue","label"]),o("div",Se,[o("div",Ue,m(a.__("Bio")),1),n(e(X),{fixedMenu:!0,onChange:r[5]||(r[5]=d=>s.bio=d),content:s.bio,editorClass:"prose-sm py-2 px-2 min-h-[200px] border-outline-gray-2 hover:border-outline-gray-3 rounded-md bg-surface-gray-3"},null,8,["content"])])])]),_:1},8,["options"]))}},je={class:"absolute left-1/2 mt-3 w-96 max-w-lg -translate-x-1/2 transform rounded-lg bg-surface-white px-4 sm:px-0 lg:max-w-3xl"},Te={class:"overflow-hidden rounded-lg p-3 shadow-2xl ring-1 ring-black ring-opacity-5"},Ee={class:"flex items-center justify-center space-x-2"},Fe={class:""},Re={class:"relative mt-2 grid w-[25.5rem] gap-2 bg-surface-white lg:grid-cols-2"},Me=["onClick"],Ie=["src"],Le={key:0,class:"mt-2 text-center text-sm text-ink-gray-4"},Ne={class:"underline",target:"_blank",href:"https://unsplash.com"},Be={__name:"EditCoverImage",emits:["select"],setup($,{emit:k}){const _=F(null),s=k,b=V({url:"lms.lms.api.get_unsplash_photos",makeParams:()=>({keyword:_.value}),auto:!0,debounce:500});R(()=>_.value,()=>{b.reload()});const w=f=>{s("select",f.file_url)},v=f=>{let h=f.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(h))return"Only image file is allowed."};return(f,h)=>(u(),P(e(se),{transition:"default"},{target:c(({isOpen:t,togglePopover:a})=>[W(f.$slots,"default",Z(ee({isOpen:t,togglePopover:a})))]),body:c(()=>[o("div",je,[o("div",Te,[o("div",Ee,[n(e(K),{type:"text",placeholder:"search by keyword",modelValue:_.value,"onUpdate:modelValue":h[0]||(h[0]=t=>_.value=t),debounce:300,class:"flex-1"},null,8,["modelValue"]),n(e(N),{fileTypes:["image/*"],validateFile:v,onSuccess:h[1]||(h[1]=t=>w(t))},{default:c(({file:t,progress:a,uploading:r,openFileSelector:d})=>[o("div",Fe,[n(e(C),{onClick:d,loading:r},{default:c(()=>[y(m(r?`Uploading ${a}%`:"Upload Image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})]),o("div",Re,[(u(!0),g(B,null,Q(e(b).data,t=>(u(),g("button",{key:t.id,class:"h-[50px] w-[200px] overflow-hidden rounded hover:opacity-80",onClick:a=>f.$emit("select",t.urls.raw)},[o("img",{src:t.urls.raw+"&w=200&h=50&fit=crop&crop=entropy,faces,focalpoint"},null,8,Ie)],8,Me))),128))]),e(b).data?(u(),g("div",Le,[y(m(f.__("Image search powered by"))+" ",1),o("a",Ne,m(f.__("Unsplash")),1)])):U("",!0)])])]),_:3}))}},ze={key:1},Ae={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},qe={class:"group relative h-[130px] w-full"},He=["src"],Oe={key:2,class:"absolute bottom-0 left-1/2 mb-4 flex -translate-x-1/2 space-x-2 opacity-0 transition-opacity focus-within:opacity-100 group-hover:opacity-100"},De={class:"mx-auto -mt-10 md:-mt-4 max-w-4xl translate-x-0 px-5"},Je={class:"flex flex-col md:flex-row items-center"},Xe=["src"],Ye={class:"ml-6"},Ge={class:"mt-2 text-3xl font-semibold text-ink-gray-9"},Ke={class:"mt-2 text-base text-ink-gray-7"},Qe={class:"mb-4 mt-6"},as={__name:"Profile",props:{username:{type:String,required:!0}},setup($){const{user:k,brand:_}=te(),s=I("$user"),b=ae(),w=oe(),v=F(""),f=F(!1),h=$;le(()=>{s.data&&t.reload(),r()});const t=V({url:"frappe.client.get",makeParams(i){return{doctype:"User",filters:{username:h.username}}}}),a=V({url:"frappe.client.set_value",makeParams(i){var l;return{doctype:"User",name:(l=t.data)==null?void 0:l.name,fieldname:"cover_image",value:i.url}},onSuccess(){t.reload()}}),r=()=>{let i=b.path.split("/");["certificates","roles","slots","schedule"].forEach(x=>{i.includes(x)&&(v.value=re(x))}),v.value||(v.value="About")};ie(()=>{if(v.value){let i={About:{name:"ProfileAbout"},Certificates:{name:"ProfileCertificates"},Roles:{name:"ProfileRoles"},Slots:{name:"ProfileEvaluator"},Schedule:{name:"ProfileEvaluationSchedule"}}[v.value];w.push(i)}}),R(()=>h.username,()=>{t.reload()});const d=()=>{f.value=!0},S=()=>{var i,l;return((i=s.data)==null?void 0:i.email)===((l=t.data)==null?void 0:l.email)},j=()=>{var l,x,p;let i=[{label:"About"},{label:"Certificates"}];return(l=s.data)!=null&&l.is_moderator&&i.push({label:"Roles"}),S()&&((x=s.data)!=null&&x.is_evaluator||(p=s.data)!=null&&p.is_moderator)&&(i.push({label:"Slots"}),i.push({label:"Schedule"})),i},T=ne(()=>{var l,x;return[{label:"People"},{label:(l=t.data)==null?void 0:l.full_name,route:{name:"Profile",params:{username:(x=k.doc)==null?void 0:x.username}}}]});return de(()=>{var i;return{title:(i=t.data)==null?void 0:i.full_name,icon:_.favicon}}),(i,l)=>{const x=L("router-view");return u(),g(B,null,[e(s).data?e(t).data?(u(),g("div",ze,[o("header",Ae,[n(e(ce),{class:"h-7",items:T.value},null,8,["items"])]),o("div",qe,[e(t).data.cover_image?(u(),g("img",{key:0,src:e(t).data.cover_image,class:"h-[130px] w-full object-cover object-center"},null,8,He)):(u(),g("div",{key:1,class:ue([{"bg-surface-gray-2":!e(t).data.cover_image},"h-[130px] w-full"])},null,2)),S()?(u(),g("div",Oe,[n(Be,{onSelect:l[0]||(l[0]=p=>e(a).submit({url:p}))},{default:c(({togglePopover:p})=>[n(e(C),{variant:"outline",onClick:We=>p()},{prefix:c(()=>[n(e(M),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:c(()=>[y(" "+m(i.__("Edit")),1)]),_:2},1032,["onClick"])]),_:1})])):U("",!0)]),o("div",De,[o("div",Je,[o("div",null,[e(t).data.user_image?(u(),g("img",{key:0,src:e(t).data.user_image,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,Xe)):(u(),P(pe,{key:1,user:e(t).data,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,["user"]))]),o("div",Ye,[o("h2",Ge,m(e(t).data.full_name),1),o("div",Ke,m(e(t).data.headline),1)]),S()?(u(),P(e(C),{key:0,class:"mt-3 sm:mt-0 md:ml-auto",onClick:l[1]||(l[1]=p=>d())},{prefix:c(()=>[n(e(M),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:c(()=>[y(" "+m(i.__("Edit Profile")),1)]),_:1})):U("",!0)]),o("div",Qe,[n(e(fe),{class:"inline-block",buttons:j(),modelValue:v.value,"onUpdate:modelValue":l[2]||(l[2]=p=>v.value=p)},null,8,["buttons","modelValue"])]),n(x,{profile:e(t)},null,8,["profile"])])])):U("",!0):(u(),P(he,{key:0})),n(Ve,{modelValue:f.value,"onUpdate:modelValue":l[3]||(l[3]=p=>f.value=p),reloadProfile:e(t),"onUpdate:reloadProfile":l[4]||(l[4]=p=>me(t)?t.value=p:null),profile:e(t)},null,8,["modelValue","reloadProfile","profile"])],64)}}};export{as as default};
