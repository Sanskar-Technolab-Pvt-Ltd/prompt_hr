import{i as Z,r as T,s as ee,x as se,aj as le,ai as oe,ae as te,H as ae,o as re,y as g,C as j,V as ie,A as v,w as ne,a as ue,u as de,d as y,e as m,f as t,g as r,k as a,h as w,j as h,m as k,ac as ce,_ as S,t as u,p as n,n as V,aw as me,bQ as pe,b1 as _e,F as fe,v as be,b4 as ge,bR as ve,aa as U}from"./index-OSkjyhkw.js";import{_ as ye}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DdVHL6EX.js";import{_ as he}from"./CourseOutline-CnQHw0kq.js";import{_ as ke}from"./MultiSelect-BA-VwAh0.js";import"./vuedraggable.umd-Qkpg2qlG.js";const Ve={class:"h-full"},Ce={class:"grid md:grid-cols-[70%,30%] h-full"},we={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Se={class:"flex items-center mt-3 md:mt-0"},xe={class:"mt-5 mb-10"},Ue={class:"container mb-5"},Ne={class:"text-lg font-semibold mb-4"},Ee={class:"mb-4"},Pe={class:"mb-1.5 text-sm text-ink-gray-5"},$e={class:"mb-4"},Te={class:"text-xs text-ink-gray-5 mb-2"},je={class:"flex items-center"},De={class:"border rounded-md w-fit py-5 px-20"},Fe={class:"ml-4"},Le={class:"mt-2 text-ink-gray-5 text-sm"},Oe={key:1,class:"mb-4"},Ie={class:"flex items-center"},Me=["src"],Re={class:"ml-4"},Ae={class:"mt-2 text-ink-gray-5 text-sm"},Be={class:"mb-4"},Ke={class:"mb-1.5 text-xs text-ink-gray-5"},qe={class:"flex items-center"},ze={class:"flex items-center bg-surface-gray-2 text-ink-gray-7 p-2 rounded-md mr-2"},He={class:"w-1/2 mb-4"},Qe={class:"container border-t"},Xe={class:"text-lg font-semibold mt-5 mb-4"},Ge={class:"grid grid-cols-2 gap-10 mb-4"},Je={key:0,class:"flex flex-col space-y-4"},We={class:"flex flex-col space-y-3"},Ye={class:"container border-t space-y-4"},Ze={class:"text-lg font-semibold mt-5"},es={class:"grid grid-cols-3"},ss={class:"border-l"},ns={__name:"CourseForm",props:{courseName:{type:String}},setup(D){const b=Z("$user"),_=T(""),{brand:F}=ee(),C=se(),f=T([]),N=le(),L=te(),{updateOnboardingStep:O}=oe("learning"),{$dialog:I}=L.appContext.config.globalProperties,p=D,l=ae({title:"",short_introduction:"",description:"",video_link:"",course_image:null,tags:"",category:"",published:!1,published_on:"",featured:!1,upcoming:!1,disable_self_learning:!1,enable_certification:!1,paid_course:!1,paid_certificate:!1,course_price:"",currency:"",evaluator:""});re(()=>{var e,s;p.courseName=="new"&&!((e=b.data)!=null&&e.is_moderator)&&!((s=b.data)!=null&&s.is_instructor)&&C.push({name:"Courses"}),p.courseName!=="new"?c.reload():j("course_form_opened"),window.addEventListener("keydown",E)});const E=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(P(),e.preventDefault())};ie(()=>{window.removeEventListener("keydown",E)});const M=g({url:"frappe.client.insert",makeParams(e){var s;return{doc:{doctype:"LMS Course",image:((s=l.course_image)==null?void 0:s.file_url)||"",instructors:f.value.map(i=>({instructor:i})),...e}}}}),R=g({url:"frappe.client.set_value",auto:!1,makeParams(e){var s;return{doctype:"LMS Course",name:e.course,fieldname:{image:((s=l.course_image)==null?void 0:s.file_url)||"",instructors:f.value.map(i=>({instructor:i})),...l}}}}),c=g({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Course",name:p.courseName}},auto:!1,onSuccess(e){Object.keys(e).forEach(i=>{i=="instructors"?(f.value=[],e.instructors.forEach(d=>{f.value.push(d.instructor)})):Object.hasOwn(l,i)&&(l[i]=e[i])});let s=["published","upcoming","disable_self_learning","paid_course","featured","enable_certification","paid_certificate"];for(let i in s){let d=s[i];l[d]=!!l[d]}e.image&&A.reload({image:e.image}),J()}}),A=g({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){l.course_image=e}}),P=()=>{c.data?R.submit({course:c.data.name},{onSuccess(){v("Success","Course updated successfully","check")},onError(e){var s;v("Error",((s=e.messages)==null?void 0:s[0])||e,"x")}}):M.submit(l,{onSuccess(e){var s;(s=b.data)!=null&&s.is_system_manager&&O("create_first_course",!0,!1,()=>{localStorage.setItem("firstCourse",e.name)}),j("course_created"),v("Success","Course created successfully","check"),C.push({name:"CourseForm",params:{courseName:e.name}})},onError(e){var s;v("Error",((s=e.messages)==null?void 0:s[0])||e,"x")}})},B=g({url:"lms.lms.api.delete_course",makeParams(e){return{course:p.courseName}},onSuccess(){v(__("Success"),__("Course deleted successfully"),"check"),C.push({name:"Courses"})}}),K=()=>{I({title:__("Delete Course"),message:__("Deleting the course will also delete all its chapters and lessons. Are you sure you want to delete this course?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(e){B.submit(),e()}}]})};ne(()=>p.courseName!=="new",e=>{e&&c.reload()});const q=e=>{let s=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","webp"].includes(s))return __("Only image file is allowed.")},z=()=>{_.value&&(l.tags=l.tags?`${l.tags}, ${_.value}`:_.value,_.value="")},H=e=>{var s;l.tags=(s=l.tags)==null?void 0:s.split(", ").filter(i=>i!==e).join(", "),_.value=""},Q=e=>{l.course_image=e},X=()=>{l.course_image=null},G=e=>{e(),N.activeTab="Categories",N.isSettingsOpen=!0},J=()=>{var s;let e=!1;(s=b.data)!=null&&s.is_moderator||(f.value.forEach(i=>{var d;!e&&i==((d=b.data)==null?void 0:d.name)&&(e=!0)}),e||C.push({name:"Courses"}))},W=ue(()=>{let e=[{label:"Courses",route:{name:"Courses"}}];return c.data&&e.push({label:l.title,route:{name:"CourseDetail",params:{courseName:p.courseName}}}),e.push({label:p.courseName=="new"?"New Course":"Edit Course",route:{name:"CourseForm",params:{courseName:p.courseName}}}),e});return de(()=>{var e;return{title:((e=c.data)==null?void 0:e.title)||__("New Course"),icon:F.favicon}}),(e,s)=>{var i,d,$;return m(),y("div",Ve,[t("div",Ce,[t("div",null,[t("header",we,[r(a(ye),{class:"h-7",items:W.value},null,8,["items"]),t("div",Se,[(i=a(c).data)!=null&&i.name?(m(),w(a(S),{key:0,onClick:s[0]||(s[0]=o=>K())},{icon:k(()=>[r(a(ce),{class:"w-4 h-4 stroke-1.5"})]),_:1})):h("",!0),r(a(S),{variant:"solid",onClick:s[1]||(s[1]=o=>P()),class:"ml-2"},{default:k(()=>[t("span",null,u(e.__("Save")),1)]),_:1})])]),t("div",xe,[t("div",Ue,[t("div",Ne,u(e.__("Details")),1),r(a(n),{modelValue:l.title,"onUpdate:modelValue":s[2]||(s[2]=o=>l.title=o),label:e.__("Title"),class:"mb-4",required:!0},null,8,["modelValue","label"]),r(a(n),{modelValue:l.short_introduction,"onUpdate:modelValue":s[3]||(s[3]=o=>l.short_introduction=o),label:e.__("Short Introduction"),placeholder:e.__("A one line introduction to the course that appears on the course card"),class:"mb-4",required:!0},null,8,["modelValue","label","placeholder"]),t("div",Ee,[t("div",Pe,[V(u(e.__("Course Description"))+" ",1),s[23]||(s[23]=t("span",{class:"text-ink-red-3"},"*",-1))]),r(a(me),{content:l.description,onChange:s[4]||(s[4]=o=>l.description=o),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),t("div",$e,[t("div",Te,[V(u(e.__("Course Image"))+" ",1),s[24]||(s[24]=t("span",{class:"text-ink-red-3"},"*",-1))]),l.course_image?(m(),y("div",Oe,[t("div",Ie,[t("img",{src:l.course_image.file_url,class:"border rounded-md w-40"},null,8,Me),t("div",Re,[r(a(S),{onClick:s[6]||(s[6]=o=>X())},{default:k(()=>[V(u(e.__("Remove")),1)]),_:1}),t("div",Ae,u(e.__("Appears on the course card in the course list")),1)])])])):(m(),w(a(_e),{key:0,fileTypes:["image/*"],validateFile:q,onSuccess:s[5]||(s[5]=o=>Q(o))},{default:k(({file:o,progress:x,uploading:ls,openFileSelector:Y})=>[t("div",je,[t("div",De,[r(a(pe),{class:"size-5 stroke-1 text-ink-gray-7"})]),t("div",Fe,[r(a(S),{onClick:Y},{default:k(()=>[V(u(e.__("Upload")),1)]),_:2},1032,["onClick"]),t("div",Le,u(e.__("Appears on the course card in the course list")),1)])])]),_:1}))]),r(a(n),{modelValue:l.video_link,"onUpdate:modelValue":s[7]||(s[7]=o=>l.video_link=o),label:e.__("Preview Video"),placeholder:e.__("Paste the youtube link of a short video introducing the course"),class:"mb-4"},null,8,["modelValue","label","placeholder"]),t("div",Be,[t("div",Ke,u(e.__("Tags")),1),t("div",qe,[l.tags?(m(!0),y(fe,{key:0},be((d=l.tags)==null?void 0:d.split(", "),o=>(m(),y("div",ze,[V(u(o)+" ",1),r(a(ge),{class:"stroke-1.5 w-3 h-3 ml-2 cursor-pointer",onClick:x=>H(o)},null,8,["onClick"])]))),256)):h("",!0),r(a(n),{modelValue:_.value,"onUpdate:modelValue":s[8]||(s[8]=o=>_.value=o),placeholder:e.__("Add a keyword and then press enter"),class:"w-72",onKeyup:s[9]||(s[9]=ve(o=>z(),["enter"])),id:"tags"},null,8,["modelValue","placeholder"])])]),t("div",He,[r(U,{doctype:"LMS Category",modelValue:l.category,"onUpdate:modelValue":s[10]||(s[10]=o=>l.category=o),label:e.__("Category"),onCreate:(o,x)=>G(x)},null,8,["modelValue","label","onCreate"])]),r(ke,{modelValue:f.value,"onUpdate:modelValue":s[11]||(s[11]=o=>f.value=o),doctype:"User",label:e.__("Instructors"),filters:{ignore_user_type:1},required:!0},null,8,["modelValue","label"])]),t("div",Qe,[t("div",Xe,u(e.__("Settings")),1),t("div",Ge,[($=a(b).data)!=null&&$.is_moderator?(m(),y("div",Je,[r(a(n),{type:"checkbox",modelValue:l.published,"onUpdate:modelValue":s[12]||(s[12]=o=>l.published=o),label:e.__("Published")},null,8,["modelValue","label"]),r(a(n),{modelValue:l.published_on,"onUpdate:modelValue":s[13]||(s[13]=o=>l.published_on=o),label:e.__("Published On"),type:"date",class:"mb-5"},null,8,["modelValue","label"])])):h("",!0),t("div",We,[r(a(n),{type:"checkbox",modelValue:l.upcoming,"onUpdate:modelValue":s[14]||(s[14]=o=>l.upcoming=o),label:e.__("Upcoming")},null,8,["modelValue","label"]),r(a(n),{type:"checkbox",modelValue:l.featured,"onUpdate:modelValue":s[15]||(s[15]=o=>l.featured=o),label:e.__("Featured")},null,8,["modelValue","label"]),r(a(n),{type:"checkbox",modelValue:l.disable_self_learning,"onUpdate:modelValue":s[16]||(s[16]=o=>l.disable_self_learning=o),label:e.__("Disable Self Enrollment")},null,8,["modelValue","label"])])])]),t("div",Ye,[t("div",Ze,u(e.__("Pricing and Certification")),1),t("div",es,[r(a(n),{type:"checkbox",modelValue:l.paid_course,"onUpdate:modelValue":s[17]||(s[17]=o=>l.paid_course=o),label:e.__("Paid Course")},null,8,["modelValue","label"]),r(a(n),{type:"checkbox",modelValue:l.enable_certification,"onUpdate:modelValue":s[18]||(s[18]=o=>l.enable_certification=o),label:e.__("Completion Certificate")},null,8,["modelValue","label"]),r(a(n),{type:"checkbox",modelValue:l.paid_certificate,"onUpdate:modelValue":s[19]||(s[19]=o=>l.paid_certificate=o),label:e.__("Paid Certificate")},null,8,["modelValue","label"])]),r(a(n),{modelValue:l.course_price,"onUpdate:modelValue":s[20]||(s[20]=o=>l.course_price=o),label:e.__("Amount")},null,8,["modelValue","label"]),r(U,{doctype:"Currency",modelValue:l.currency,"onUpdate:modelValue":s[21]||(s[21]=o=>l.currency=o),filters:{enabled:1},label:e.__("Currency")},null,8,["modelValue","label"]),l.paid_certificate?(m(),w(U,{key:0,doctype:"Course Evaluator",modelValue:l.evaluator,"onUpdate:modelValue":s[22]||(s[22]=o=>l.evaluator=o),label:e.__("Evaluator")},null,8,["modelValue","label"])):h("",!0)])])]),t("div",ss,[a(c).data?(m(),w(he,{key:0,courseName:a(c).data.name,title:e.__("Course Outline"),allowEdit:!0},null,8,["courseName","title"])):h("",!0)])])])}}};export{ns as default};
