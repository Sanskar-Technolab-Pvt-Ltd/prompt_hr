import{x as j,i as z,s as R,ai as A,H as F,r as K,o as H,y as p,C as U,V as Q,A as S,a as G,u as J,d as N,e as f,f as s,g as o,k as n,m as b,n as _,t as d,_ as h,p as i,h as W,bQ as X,b1 as Y,aa as g,aw as Z}from"./index-OSkjyhkw.js";import{_ as ee}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DdVHL6EX.js";import{_ as le}from"./MultiSelect-BA-VwAh0.js";const ae={class:""},te={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},se={class:"w-1/2 mx-auto py-5"},oe={class:""},ne={class:"text-lg font-semibold mb-4"},ie={class:"space-y-4 mb-4"},de={class:"flex items-center space-x-5"},re={class:"mb-4"},me={class:"text-xs text-ink-gray-5 mb-2"},ue={class:"flex items-center"},ce={class:"border rounded-md w-fit py-5 px-20"},pe={class:"ml-4"},be={class:"mt-2 text-ink-gray-5 text-sm"},_e={key:1,class:"mb-4"},fe={class:"flex items-center"},he=["src"],ge={class:"ml-4"},ve={class:"mt-2 text-ink-gray-5 text-sm"},ye={class:"my-10"},Ve={class:"text-lg font-semibold mb-4"},we={class:"grid grid-cols-2 gap-10"},ke={class:"mb-10"},Be={class:"text-lg font-semibold mb-4"},Ue={class:"grid grid-cols-2 gap-10"},Se={class:""},Ne={class:"text-lg font-semibold mb-4"},Ee={class:"my-10"},Ce={class:"text-lg font-semibold mb-4"},De={class:"block text-sm text-ink-gray-5 mb-1"},Me={__name:"BatchForm",props:{batchName:{type:String,required:!0}},setup(E){const v=j(),y=z("$user"),{brand:C}=R(),{updateOnboardingStep:D}=A("learning"),m=E,t=F({title:"",published:!1,description:"",batch_details:"",start_date:"",end_date:"",start_time:"",end_time:"",timezone:"",evaluation_end_date:"",confirmation_email_template:"",seat_count:"",medium:"",category:"",allow_self_enrollment:!1,certification:!1,image:null,paid_batch:!1,currency:"",amount:0}),u=K([]);H(()=>{y.data||(window.location.href="/login"),m.batchName!="new"?c.reload():U("batch_form_opened"),window.addEventListener("keydown",V)});const V=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(w(),e.preventDefault())};Q(()=>{window.removeEventListener("keydown",V)});const x=p({url:"frappe.client.insert",makeParams(e){var l;return{doc:{doctype:"LMS Batch",meta_image:(l=t.image)==null?void 0:l.file_url,instructors:u.value.map(a=>({instructor:a})),...t}}}}),c=p({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Batch",name:m.batchName}},onSuccess(e){Object.keys(e).forEach(a=>{if(a=="instructors")e.instructors.forEach(r=>{u.value.push(r.instructor)});else if(["start_time","end_time"].includes(a)){let[r,k,B]=e[a].split(":");r=r.length==1?"0"+r:r,t[a]=`${r}:${k}`}else Object.hasOwn(t,a)&&(t[a]=e[a])});let l=["published","paid_batch","allow_self_enrollment","certification"];for(let a in l){let r=l[a];t[r]=!!t[r]}e.meta_image&&L.reload({image:e.meta_image})}}),T=p({url:"frappe.client.set_value",makeParams(e){var l;return{doctype:"LMS Batch",name:m.batchName,fieldname:{meta_image:(l=t.image)==null?void 0:l.file_url,instructors:u.value.map(a=>({instructor:a})),...t}}}}),L=p({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){t.image=e}}),w=()=>{c.data?O():M()},M=()=>{x.submit({},{onSuccess(e){var l;(l=y.data)!=null&&l.is_system_manager&&D("create_first_batch",!0,!1,()=>{localStorage.setItem("firstBatch",e.name)}),U("batch_created"),v.push({name:"BatchDetail",params:{batchName:e.name}})},onError(e){var l;S("Error",((l=e.messages)==null?void 0:l[0])||e,"x")}})},O=()=>{T.submit({},{onSuccess(e){v.push({name:"BatchDetail",params:{batchName:e.name}})},onError(e){var l;S("Error",((l=e.messages)==null?void 0:l[0])||e,"x")}})},$=e=>{t.image=e},q=()=>{t.image=null},P=e=>{let l=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(l))return"Only image file is allowed."},I=G(()=>{let e=[{label:"Batches",route:{name:"Batches"}}];return c.data&&e.push({label:c.data.title,route:{name:"BatchDetail",params:{batchName:m.batchName}}}),e.push({label:m.batchName=="new"?"New Batch":"Edit Batch",route:{name:"BatchForm",params:{batchName:m.batchName}}}),e});return J(()=>{var e;return{title:m.batchName=="new"?"New Batch":(e=c.data)==null?void 0:e.title,icon:C.favicon}}),(e,l)=>(f(),N("div",ae,[s("header",te,[o(n(ee),{class:"h-7",items:I.value},null,8,["items"]),o(n(h),{variant:"solid",onClick:l[0]||(l[0]=a=>w())},{default:b(()=>[_(d(e.__("Save")),1)]),_:1})]),s("div",se,[s("div",oe,[s("div",ne,d(e.__("Details")),1),s("div",ie,[o(n(i),{modelValue:t.title,"onUpdate:modelValue":l[1]||(l[1]=a=>t.title=a),label:e.__("Title"),required:!0,class:"w-full"},null,8,["modelValue","label"]),s("div",de,[o(n(i),{modelValue:t.published,"onUpdate:modelValue":l[2]||(l[2]=a=>t.published=a),type:"checkbox",label:e.__("Published")},null,8,["modelValue","label"]),o(n(i),{modelValue:t.allow_self_enrollment,"onUpdate:modelValue":l[3]||(l[3]=a=>t.allow_self_enrollment=a),type:"checkbox",label:e.__("Allow self enrollment")},null,8,["modelValue","label"]),o(n(i),{modelValue:t.certification,"onUpdate:modelValue":l[4]||(l[4]=a=>t.certification=a),type:"checkbox",label:e.__("Certification")},null,8,["modelValue","label"])])])]),s("div",re,[s("div",me,d(e.__("Meta Image")),1),t.image?(f(),N("div",_e,[s("div",fe,[s("img",{src:t.image.file_url,class:"border rounded-md w-40"},null,8,he),s("div",ge,[o(n(h),{onClick:l[6]||(l[6]=a=>q())},{default:b(()=>[_(d(e.__("Remove")),1)]),_:1}),s("div",ve,d(e.__("Appears when the batch URL is shared on any online platform")),1)])])])):(f(),W(n(Y),{key:0,fileTypes:["image/*"],validateFile:P,onSuccess:l[5]||(l[5]=a=>$(a))},{default:b(({file:a,progress:r,uploading:k,openFileSelector:B})=>[s("div",ue,[s("div",ce,[o(n(X),{class:"size-5 stroke-1 text-ink-gray-7"})]),s("div",pe,[o(n(h),{onClick:B},{default:b(()=>[_(d(e.__("Upload")),1)]),_:2},1032,["onClick"]),s("div",be,d(e.__("Appears when the batch URL is shared on any online platform")),1)])])]),_:1}))]),o(le,{modelValue:u.value,"onUpdate:modelValue":l[7]||(l[7]=a=>u.value=a),doctype:"User",label:e.__("Instructors"),required:!0,filters:{ignore_user_type:1}},null,8,["modelValue","label"]),s("div",ye,[s("div",Ve,d(e.__("Date and Time")),1),s("div",we,[s("div",null,[o(n(i),{modelValue:t.start_date,"onUpdate:modelValue":l[8]||(l[8]=a=>t.start_date=a),label:e.__("Start Date"),type:"date",class:"mb-4",required:!0},null,8,["modelValue","label"]),o(n(i),{modelValue:t.end_date,"onUpdate:modelValue":l[9]||(l[9]=a=>t.end_date=a),label:e.__("End Date"),type:"date",class:"mb-4",required:!0},null,8,["modelValue","label"]),o(n(i),{modelValue:t.timezone,"onUpdate:modelValue":l[10]||(l[10]=a=>t.timezone=a),label:e.__("Timezone"),type:"text",placeholder:e.__("Example: IST (+5:30)"),class:"mb-4",required:!0},null,8,["modelValue","label","placeholder"])]),s("div",null,[o(n(i),{modelValue:t.start_time,"onUpdate:modelValue":l[11]||(l[11]=a=>t.start_time=a),label:e.__("Start Time"),type:"time",class:"mb-4",required:!0},null,8,["modelValue","label"]),o(n(i),{modelValue:t.end_time,"onUpdate:modelValue":l[12]||(l[12]=a=>t.end_time=a),label:e.__("End Time"),type:"time",class:"mb-4",required:!0},null,8,["modelValue","label"])])])]),s("div",ke,[s("div",Be,d(e.__("Settings")),1),s("div",Ue,[s("div",null,[o(n(i),{modelValue:t.seat_count,"onUpdate:modelValue":l[13]||(l[13]=a=>t.seat_count=a),label:e.__("Seat Count"),type:"number",class:"mb-4",placeholder:e.__("Number of seats available")},null,8,["modelValue","label","placeholder"]),o(n(i),{modelValue:t.evaluation_end_date,"onUpdate:modelValue":l[14]||(l[14]=a=>t.evaluation_end_date=a),label:e.__("Evaluation End Date"),type:"date",class:"mb-4"},null,8,["modelValue","label"]),o(g,{doctype:"Email Template",label:e.__("Email Template"),modelValue:t.confirmation_email_template,"onUpdate:modelValue":l[15]||(l[15]=a=>t.confirmation_email_template=a)},null,8,["label","modelValue"])]),s("div",null,[o(n(i),{modelValue:t.medium,"onUpdate:modelValue":l[16]||(l[16]=a=>t.medium=a),type:"select",options:[{label:"Online",value:"Online"},{label:"Offline",value:"Offline"}],label:e.__("Medium"),class:"mb-4"},null,8,["modelValue","label"]),o(g,{doctype:"LMS Category",label:e.__("Category"),modelValue:t.category,"onUpdate:modelValue":l[17]||(l[17]=a=>t.category=a)},null,8,["label","modelValue"])])])]),s("div",Se,[s("div",Ne,d(e.__("Payment")),1),s("div",null,[o(n(i),{modelValue:t.paid_batch,"onUpdate:modelValue":l[18]||(l[18]=a=>t.paid_batch=a),type:"checkbox",label:e.__("Paid Batch")},null,8,["modelValue","label"]),o(n(i),{modelValue:t.amount,"onUpdate:modelValue":l[19]||(l[19]=a=>t.amount=a),label:e.__("Amount"),type:"number",class:"my-4"},null,8,["modelValue","label"]),o(g,{doctype:"Currency",modelValue:t.currency,"onUpdate:modelValue":l[20]||(l[20]=a=>t.currency=a),filters:{enabled:1},label:e.__("Currency")},null,8,["modelValue","label"])])]),s("div",Ee,[s("div",Ce,d(e.__("Description")),1),o(n(i),{modelValue:t.description,"onUpdate:modelValue":l[21]||(l[21]=a=>t.description=a),label:e.__("Short Description"),type:"textarea",class:"my-4",placeholder:e.__("Short description of the batch"),required:!0},null,8,["modelValue","label","placeholder"]),s("div",null,[s("label",De,[_(d(e.__("Batch Details"))+" ",1),l[23]||(l[23]=s("span",{class:"text-ink-red-3"},"*",-1))]),o(n(Z),{content:t.batch_details,onChange:l[22]||(l[22]=a=>t.batch_details=a),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem] mb-4"},null,8,["content"])])])])]))}};export{Me as default};
