import{i as D,o as R,r as h,H as W,y as p,A as m,a as q,d as f,e as b,f as d,t as r,j as T,bf as G,g as s,k as l,F as H,v as I,be as v,p as c,b4 as L,bg as O,m as w,n as E,P as X,_ as x,bh as Y,ay as J}from"./index-OSkjyhkw.js";const K={class:"mt-7 mb-20"},Q={class:"mb-4 text-lg font-semibold text-ink-gray-9"},Z={class:""},ee={class:"grid grid-cols-3 md:grid-cols-4 gap-4 text-sm text-ink-gray-7 mb-4"},ae={class:"grid grid-cols-3 md:grid-cols-4 gap-4 mb-4 group"},te={class:"grid grid-cols-3 md:grid-cols-4 gap-4 mb-4"},le={class:"my-10"},oe={class:"mb-4 text-lg font-semibold text-ink-gray-9"},se={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},de={class:"mb-4 text-lg font-semibold text-ink-gray-9"},ne={key:0,class:"flex items-center bg-surface-green-2 text-green-900 text-sm p-1 rounded-md mb-4 w-fit"},re={__name:"ProfileEvaluator",props:{profile:{type:Object,required:!0}},setup(P){var $;const M=D("$user"),g=P;R(()=>{var e,a,i;((e=M.data)==null?void 0:e.name)!==((a=g.profile.data)==null?void 0:a.name)&&(window.location.href=`/user/${(i=g.profile.data)==null?void 0:i.username}`)});const V=h(0),y=h(null),_=h(null),o=W({day:"",start_time:"",end_time:""}),n=p({url:"lms.lms.api.get_evaluator_details",params:{evaluator:($=g.profile.data)==null?void 0:$.name},auto:!0,onSuccess(e){e.slots.unavailable_from&&(y.value=e.slots.unavailable_from),e.slots.unavailable_to&&(_.value=e.slots.unavailable_to)}}),z=p({url:"frappe.client.insert",makeParams(e){var a;return{doc:{doctype:"Evaluator Schedule",parent:(a=n.data)==null?void 0:a.slots.name,parentfield:"schedule",parenttype:"Course Evaluator",...o}}},onSuccess(){m("Success","Slot added successfully","check"),n.reload(),V.value=0,o.day="",o.start_time="",o.end_time=""},onError(e){var a;m("Error",((a=e.messages)==null?void 0:a[0])||e,"x")}}),A=p({url:"frappe.client.set_value",makeParams(e){return{doctype:"Evaluator Schedule",name:e.name,fieldname:e.field,value:e.value}},onSuccess(){m("Success","Availability updated successfully","check")},onError(e){var a;m("Error",((a=e.messages)==null?void 0:a[0])||e,"x")}}),B=p({url:"frappe.client.delete",makeParams(e){return{doctype:"Evaluator Schedule",name:e.name}},onSuccess(){m("Success","Slot deleted successfully","check"),n.reload()},onError(e){var a;m("Error",((a=e.messages)==null?void 0:a[0])||e,"x")}}),F=p({url:"frappe.client.set_value",makeParams(e){var a;return{doctype:"Course Evaluator",name:(a=n.data)==null?void 0:a.slots.name,fieldname:e.field,value:e.value}},onSuccess(){m("Success","Unavailability updated successfully","check")},onError(e){var a;m("Error",((a=e.messages)==null?void 0:a[0])||e,"x")}}),k=(e,a,i)=>{A.submit({name:e,field:a,value:i},{validate(){if(!i)return`Please enter a value for ${J(a)}`}})},S=()=>{!o.day||!o.start_time||!o.end_time||z.submit()},N=e=>{B.submit({name:e})},j=p({url:"frappe.integrations.doctype.google_calendar.google_calendar.authorize_access",makeParams(){var e;return{g_calendar:(e=n.data)==null?void 0:e.calendar,reauthorize:1}},onSuccess(e){window.open(e.url)}}),U=q(()=>[{label:"Monday",value:"Monday"},{label:"Tuesday",value:"Tuesday"},{label:"Wednesday",value:"Wednesday"},{label:"Thursday",value:"Thursday"},{label:"Friday",value:"Friday"},{label:"Saturday",value:"Saturday"},{label:"Sunday",value:"Sunday"}]);return(e,a)=>{var i,C;return b(),f("div",K,[d("h2",Q,r(e.__("My availability")),1),d("div",Z,[d("div",ee,[d("div",null,r(e.__("Day")),1),d("div",null,r(e.__("Start Time")),1),d("div",null,r(e.__("End Time")),1)]),l(n).data?(b(!0),f(H,{key:0},I(l(n).data.slots.schedule,t=>(b(),f("div",ae,[s(l(c),{type:"select",options:U.value,modelValue:t.day,"onUpdate:modelValue":u=>t.day=u,onFocusout:v(u=>k(t.name,"day",t.day),["stop"])},null,8,["options","modelValue","onUpdate:modelValue","onFocusout"]),s(l(c),{type:"time",modelValue:t.start_time,"onUpdate:modelValue":u=>t.start_time=u,onFocusout:v(u=>k(t.name,"start_time",t.start_time),["stop"])},null,8,["modelValue","onUpdate:modelValue","onFocusout"]),s(l(c),{type:"time",modelValue:t.end_time,"onUpdate:modelValue":u=>t.end_time=u,onFocusout:v(u=>k(t.name,"end_time",t.end_time),["stop"])},null,8,["modelValue","onUpdate:modelValue","onFocusout"]),s(l(L),{onClick:u=>N(t.name),class:"w-6 h-auto stroke-1.5 text-red-900 rounded-md cursor-pointer p-1 bg-surface-red-2 hidden group-hover:block"},null,8,["onClick"])]))),256)):T("",!0),G(d("div",te,[s(l(c),{type:"select",options:U.value,modelValue:o.day,"onUpdate:modelValue":a[0]||(a[0]=t=>o.day=t),onFocusout:a[1]||(a[1]=v(t=>S(),["stop"]))},null,8,["options","modelValue"]),s(l(c),{type:"time",modelValue:o.start_time,"onUpdate:modelValue":a[2]||(a[2]=t=>o.start_time=t),onFocusout:a[3]||(a[3]=v(t=>S(),["stop"]))},null,8,["modelValue"]),s(l(c),{type:"time",modelValue:o.end_time,"onUpdate:modelValue":a[4]||(a[4]=t=>o.end_time=t),onFocusout:a[5]||(a[5]=v(t=>S(),["stop"]))},null,8,["modelValue"])],512),[[O,V.value]]),s(l(x),{onClick:a[6]||(a[6]=t=>V.value=1)},{prefix:w(()=>[s(l(X),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:w(()=>[E(" "+r(e.__("Add Slot")),1)]),_:1})]),d("div",le,[d("h2",oe,r(e.__("I am unavailable")),1),d("div",se,[s(l(c),{type:"date",label:e.__("From"),modelValue:y.value,"onUpdate:modelValue":a[7]||(a[7]=t=>y.value=t),onBlur:a[8]||(a[8]=()=>{l(F).submit({field:"unavailable_from",value:y.value})})},null,8,["label","modelValue"]),s(l(c),{type:"date",label:e.__("To"),modelValue:_.value,"onUpdate:modelValue":a[9]||(a[9]=t=>_.value=t),onBlur:a[10]||(a[10]=()=>{l(F).submit({field:"unavailable_to",value:_.value})})},null,8,["label","modelValue"])])]),d("div",null,[d("h2",de,r(e.__("My calendar")),1),(i=l(n).data)!=null&&i.calendar&&((C=l(n).data)!=null&&C.is_authorized)?(b(),f("div",ne,[s(l(Y),{class:"h-4 w-4 stroke-1.5 mr-2"}),E(" "+r(e.__("Your calendar is set.")),1)])):T("",!0),s(l(x),{onClick:a[11]||(a[11]=()=>l(j).submit())},{default:w(()=>[E(r(e.__("Authorize Google Calendar Access")),1)]),_:1})])])}}};export{re as default};
