import{D as te,E as X,r as B,i as ee,ai as ae,H as L,y as v,w as se,a as H,h as z,e as d,m as p,f as u,d as b,j as g,bf as Y,ca as Z,t as f,g as n,k as l,aw as le,p as c,F as x,v as I,aa as oe,J as ne,A as k,s as ie,x as ue,o as re,V as de,u as me,b as _e,_ as $,n as C,P as ce,ac as pe,M as fe}from"./index-OSkjyhkw.js";import{_ as be}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DdVHL6EX.js";import{_ as qe,a as ke,b as ye,c as ve,d as Ve,e as we,f as he}from"./ListView-yKC6cFSr.js";const ge={class:"space-y-4"},ze={key:0,class:"flex items-center text-xs text-ink-gray-7 space-x-5"},Qe={class:"flex items-center space-x-2"},Se={for:"existing",class:"cursor-pointer"},$e={class:"flex items-center space-x-2"},xe={for:"new",class:"cursor-pointer"},De={key:1,class:"space-y-2"},Me={class:"block text-xs text-ink-gray-5 mb-1"},Ue={key:0,class:"divide-y border-t"},Ee={class:"space-y-4 py-2"},Ce={class:"space-y-2"},Le={key:2,class:"space-y-2"},Ie={__name:"Question",props:te({title:{type:String,default:__("Add a new question")},questionDetail:{type:[Object,null],required:!0}},{modelValue:{},modelModifiers:{},quiz:{},quizModifiers:{}}),emits:["update:modelValue","update:quiz"],setup(Q){const V=X(Q,"modelValue"),w=X(Q,"quiz"),m=B(null),h=B(!1),D=ee("$user"),{updateOnboardingStep:y}=ae("learning"),a=L({question:"",marks:1}),o=L({question:"",type:"Choices",marks:1}),r=()=>{let e=["option","is_correct","explanation","possibility"],s=1;e.forEach(t=>{for(;s<=4;)o[`${t}_${s}`]=t==="is_correct"?!1:null,s++})};r();const q=Q,M=v({url:"frappe.client.get",makeParams(){return{doctype:"LMS Question",name:q.questionDetail.question}},auto:!1,onSuccess(e){let s=1;for(h.value=!0,Object.keys(e).forEach(t=>{Object.hasOwn(o,t)&&(o[t]=e[t])});s<=4;)o[`is_correct_${s}`]=!!e[`is_correct_${s}`],s++;o.marks=q.questionDetail.marks}});se(V,()=>{V.value&&(h.value=!1,q.questionDetail.question?M.fetch():(o.question="",o.marks=0,o.type="Choices",a.question="",a.marks=0,m.value=null,r()),q.questionDetail.marks&&(o.marks=q.questionDetail.marks))});const U=v({url:"frappe.client.insert",makeParams(e){return{doc:{doctype:"LMS Quiz Question",parent:w.value.data.name,parentfield:"questions",parenttype:"LMS Quiz",...e}}}}),P=v({url:"frappe.client.insert",makeParams(e){return{doc:{doctype:"LMS Question",...o}}}}),O=e=>{var s;(s=q.questionDetail)!=null&&s.question?A(e):T(e)},T=e=>{m.value=="existing"?S({question:a.question,marks:a.marks},e):P.submit({},{onSuccess(s){S({question:s.name,marks:o.marks},e)},onError(s){var t;k(__("Error"),__(((t=s.messages)==null?void 0:t[0])||s),"x")}})},S=(e,s)=>{U.submit({...e},{onSuccess(){var t;(t=D.data)!=null&&t.is_system_manager&&y("create_first_quiz"),V.value=!1,k(__("Success"),__("Question added successfully"),"check"),w.value.reload(),s()},onError(t){var _;k(__("Error"),__(((_=t.messages)==null?void 0:_[0])||t),"x"),s()}})},E=v({url:"frappe.client.set_value",auto:!1,makeParams(e){var s;return{doctype:"LMS Question",name:(s=M.data)==null?void 0:s.name,fieldname:{...o}}}}),j=v({url:"frappe.client.set_value",auto:!1,makeParams(e){return{doctype:"LMS Quiz Question",name:q.questionDetail.name,fieldname:{marks:o.marks}}}}),A=e=>{E.submit({},{onSuccess(){j.submit({},{onSuccess(){V.value=!1,k(__("Success"),__("Question updated successfully"),"check"),w.value.reload(),e()}})},onError(s){var t;k(__("Error"),__(((t=s.messages)==null?void 0:t[0])||s),"x")}})},N=H(()=>({title:__(q.title),size:"xl",actions:[{label:__("Submit"),variant:"solid",onClick:e=>{O(e)}}]}));return(e,s)=>(d(),z(l(ne),{modelValue:V.value,"onUpdate:modelValue":s[7]||(s[7]=t=>V.value=t),options:N.value},{"body-content":p(()=>[u("div",ge,[h.value?g("",!0):(d(),b("div",ze,[u("div",Qe,[Y(u("input",{type:"radio",id:"existing",value:"existing","onUpdate:modelValue":s[0]||(s[0]=t=>m.value=t),class:"w-3 h-3 cursor-pointer"},null,512),[[Z,m.value]]),u("label",Se,f(e.__("Add an existing question")),1)]),u("div",$e,[Y(u("input",{type:"radio",id:"new",value:"new","onUpdate:modelValue":s[1]||(s[1]=t=>m.value=t),class:"w-3 h-3 cursor-pointer"},null,512),[[Z,m.value]]),u("label",xe,f(e.__("Create a new question")),1)])])),m.value=="new"||h.value?(d(),b("div",De,[u("div",null,[u("label",Me,f(e.__("Question")),1),n(l(le),{content:o.question,onChange:s[2]||(s[2]=t=>o.question=t),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),n(l(c),{modelValue:o.marks,"onUpdate:modelValue":s[3]||(s[3]=t=>o.marks=t),label:e.__("Marks"),type:"number"},null,8,["modelValue","label"]),n(l(c),{label:e.__("Type"),modelValue:o.type,"onUpdate:modelValue":s[4]||(s[4]=t=>o.type=t),type:"select",options:["Choices","User Input","Open Ended"],class:"pb-2",required:!0},null,8,["label","modelValue"]),o.type=="Choices"?(d(),b("div",Ue,[(d(),b(x,null,I(4,t=>u("div",Ee,[n(l(c),{label:e.__("Option")+" "+t,modelValue:o[`option_${t}`],"onUpdate:modelValue":_=>o[`option_${t}`]=_,required:t<=2},null,8,["label","modelValue","onUpdate:modelValue","required"]),n(l(c),{label:e.__("Explanation"),modelValue:o[`explanation_${t}`],"onUpdate:modelValue":_=>o[`explanation_${t}`]=_},null,8,["label","modelValue","onUpdate:modelValue"]),n(l(c),{label:e.__("Correct Answer"),modelValue:o[`is_correct_${t}`],"onUpdate:modelValue":_=>o[`is_correct_${t}`]=_,type:"checkbox"},null,8,["label","modelValue","onUpdate:modelValue"])])),64))])):o.type=="User Input"?(d(),b(x,{key:1},I(4,t=>u("div",Ce,[n(l(c),{label:e.__("Possibility")+" "+t,modelValue:o[`possibility_${t}`],"onUpdate:modelValue":_=>o[`possibility_${t}`]=_,required:t==1},null,8,["label","modelValue","onUpdate:modelValue","required"])])),64)):g("",!0)])):m.value=="existing"?(d(),b("div",Le,[n(oe,{modelValue:a.question,"onUpdate:modelValue":s[5]||(s[5]=t=>a.question=t),label:e.__("Select a question"),doctype:"LMS Question"},null,8,["modelValue","label"]),n(l(c),{modelValue:a.marks,"onUpdate:modelValue":s[6]||(s[6]=t=>a.marks=t),label:e.__("Marks"),type:"number"},null,8,["modelValue","label"])])):g("",!0)])]),_:1},8,["modelValue","options"]))}},Pe={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Oe={class:"space-x-2"},Te={class:"w-3/4 mx-auto py-5"},je={class:"mb-8"},Ae={class:"font-semibold mb-4"},Ne={key:0},Re={class:"grid grid-cols-2 gap-5 mt-4 mb-8"},Fe={class:"mb-8"},Be={class:"font-semibold mb-4"},He={class:"grid grid-cols-3 gap-5 my-4"},Ke={class:"mb-8"},Je={class:"font-semibold mb-4"},Ge={class:"grid grid-cols-3"},We={class:"flex items-center justify-between mb-4"},Xe={class:"font-semibold"},Ye=["innerHTML"],Ze={key:1,class:"text-xs"},es={class:"flex gap-2"},ls={__name:"QuizForm",props:{quizID:{type:String,required:!0}},setup(Q){const{brand:V}=ie(),w=B(!1),m=L({question:"",marks:0,name:""}),h=ee("$user"),D=ue(),y=Q,a=L({title:"",total_marks:0,passing_percentage:0,max_attempts:0,duration:0,limit_questions_to:0,show_answers:!0,show_submission_history:!1,shuffle_questions:!1,questions:[]});re(()=>{var e,s;y.quizID=="new"&&!((e=h.data)!=null&&e.is_moderator)&&!((s=h.data)!=null&&s.is_instructor)&&D.push({name:"Courses"}),y.quizID!=="new"&&r.reload(),window.addEventListener("keydown",o)});const o=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&(U(),e.preventDefault())};de(()=>{window.removeEventListener("keydown",o)}),se(()=>y.quizID!=="new",e=>{e&&r.reload()});const r=v({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Quiz",name:y.quizID}},auto:!1,onSuccess(e){Object.keys(e).forEach(t=>{Object.hasOwn(a,t)&&(a[t]=e[t])});let s=["show_answers","show_submission_history","shuffle_questions"];for(let t in s){let _=s[t];a[_]=!!a[_]}}}),q=v({url:"frappe.client.insert",auto:!1,makeParams(e){return{doc:{doctype:"LMS Quiz",...a}}}}),M=v({url:"frappe.client.set_value",auto:!1,makeParams(e){return{doctype:"LMS Quiz",name:e.quizID,fieldname:{total_marks:T(),...a}}}}),U=()=>{var e;(e=r.data)!=null&&e.name?O():P()},P=()=>{q.submit({},{onSuccess(e){k(__("Success"),__("Quiz created successfully"),"check"),D.push({name:"QuizForm",params:{quizID:e.name}})},onError(e){var s;k(__("Error"),__(((s=e.messages)==null?void 0:s[0])||e),"x")}})},O=()=>{var e;M.submit({quizID:(e=r.data)==null?void 0:e.name},{onSuccess(s){a.total_marks=s.total_marks,k(__("Success"),__("Quiz updated successfully"),"check")},onError(s){var t;k(__("Error"),__(((t=s.messages)==null?void 0:t[0])||s),"x")}})},T=()=>{let e=0;return a.limit_questions_to&&a.questions.length>0?a.questions[0].marks*a.limit_questions_to:(a.questions.forEach(s=>{e+=s.marks}),e)},S=H(()=>[{label:__("ID"),key:"question",width:"10rem"},{label:__("Question"),key:__("question_detail"),width:"40rem"},{label:__("Marks"),key:"marks",width:"5rem"}]),E=(e=null)=>{e?(m.question=e.question,m.marks=e.marks,m.name=e.name):(m.question="",m.marks=0,m.name=""),w.value=!0},j=v({url:"lms.lms.api.delete_documents",makeParams(e){return{doctype:"LMS Quiz Question",documents:e.questions}}}),A=(e,s)=>{j.submit({questions:Array.from(e)},{onSuccess(){k(__("Success"),__("Questions deleted successfully"),"check"),r.reload(),s()}})},N=H(()=>{var s;let e=[{label:__("Quizzes"),route:{name:"Quizzes"}}];return e.push({label:y.quizID=="new"?__("New Quiz"):(s=r.data)==null?void 0:s.title,route:{name:"QuizForm",params:{quizID:y.quizID}}}),e});return me(()=>{var e;return{title:y.quizID=="new"?__("New Quiz"):(e=r.data)==null?void 0:e.title,icon:V.favicon}}),(e,s)=>{var _,K,J,G;const t=_e("router-link");return d(),b(x,null,[u("header",Pe,[n(l(be),{items:N.value},null,8,["items"]),u("div",Oe,[(_=l(r).data)!=null&&_.name?(d(),z(t,{key:0,to:{name:"QuizPage",params:{quizID:l(r).data.name}}},{default:p(()=>[n(l($),null,{default:p(()=>[C(f(e.__("Open")),1)]),_:1})]),_:1},8,["to"])):g("",!0),(K=l(r).data)!=null&&K.name?(d(),z(t,{key:1,to:{name:"QuizSubmissionList",params:{quizID:l(r).data.name}}},{default:p(()=>[n(l($),null,{default:p(()=>[C(f(e.__("Submission List")),1)]),_:1})]),_:1},8,["to"])):g("",!0),n(l($),{variant:"solid",onClick:s[0]||(s[0]=i=>U())},{default:p(()=>[C(f(e.__("Save")),1)]),_:1})])]),u("div",Te,[u("div",je,[u("div",Ae,f(e.__("Details")),1),n(l(c),{modelValue:a.title,"onUpdate:modelValue":s[1]||(s[1]=i=>a.title=i),label:(J=l(r).data)!=null&&J.name?e.__("Title"):e.__("Enter a title and save the quiz to proceed"),required:!0},null,8,["modelValue","label"]),(G=l(r).data)!=null&&G.name?(d(),b("div",Ne,[u("div",Re,[n(l(c),{type:"number",modelValue:a.max_attempts,"onUpdate:modelValue":s[2]||(s[2]=i=>a.max_attempts=i),label:e.__("Maximum Attempts")},null,8,["modelValue","label"]),n(l(c),{type:"number",modelValue:a.duration,"onUpdate:modelValue":s[3]||(s[3]=i=>a.duration=i),label:e.__("Duration (in minutes)")},null,8,["modelValue","label"]),n(l(c),{modelValue:a.total_marks,"onUpdate:modelValue":s[4]||(s[4]=i=>a.total_marks=i),label:e.__("Total Marks"),disabled:""},null,8,["modelValue","label"]),n(l(c),{modelValue:a.passing_percentage,"onUpdate:modelValue":s[5]||(s[5]=i=>a.passing_percentage=i),label:e.__("Passing Percentage")},null,8,["modelValue","label"])]),u("div",Fe,[u("div",Be,f(e.__("Settings")),1),u("div",He,[n(l(c),{modelValue:a.show_answers,"onUpdate:modelValue":s[6]||(s[6]=i=>a.show_answers=i),type:"checkbox",label:e.__("Show Answers")},null,8,["modelValue","label"]),n(l(c),{modelValue:a.show_submission_history,"onUpdate:modelValue":s[7]||(s[7]=i=>a.show_submission_history=i),type:"checkbox",label:e.__("Show Submission History")},null,8,["modelValue","label"])])]),u("div",Ke,[u("div",Je,f(e.__("Shuffle Settings")),1),u("div",Ge,[n(l(c),{modelValue:a.shuffle_questions,"onUpdate:modelValue":s[8]||(s[8]=i=>a.shuffle_questions=i),type:"checkbox",label:e.__("Shuffle Questions")},null,8,["modelValue","label"]),a.shuffle_questions?(d(),z(l(c),{key:0,modelValue:a.limit_questions_to,"onUpdate:modelValue":s[9]||(s[9]=i=>a.limit_questions_to=i),label:e.__("Limit Questions To")},null,8,["modelValue","label"])):g("",!0)])]),u("div",null,[u("div",We,[u("div",Xe,f(e.__("Questions")),1),n(l($),{onClick:s[10]||(s[10]=i=>E())},{prefix:p(()=>[n(l(ce),{class:"w-4 h-4"})]),default:p(()=>[C(" "+f(e.__("New Question")),1)]),_:1})]),n(l(he),{columns:S.value,rows:a.questions,"row-key":"name",options:{showTooltip:!1}},{default:p(()=>[n(l(qe),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:p(()=>[(d(!0),b(x,null,I(S.value,i=>(d(),z(l(ke),{item:i},null,8,["item"]))),256))]),_:1}),n(l(ye),null,{default:p(()=>[(d(!0),b(x,null,I(a.questions,i=>(d(),z(l(ve),{row:i,onClick:R=>E(i),class:"cursor-pointer"},{default:p(({idx:R,column:W,item:F})=>[n(l(Ve),{item:F},{default:p(()=>[W.key=="question_detail"?(d(),b("div",{key:0,class:"text-xs truncate h-4",innerHTML:F},null,8,Ye)):(d(),b("div",Ze,f(F),1))]),_:2},1032,["item"])]),_:2},1032,["row","onClick"]))),256))]),_:1}),n(l(we),null,{actions:p(({unselectAll:i,selections:R})=>[u("div",es,[n(l($),{variant:"ghost",onClick:W=>A(R,i)},{default:p(()=>[n(l(pe),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])])])):g("",!0)])]),n(Ie,{modelValue:w.value,"onUpdate:modelValue":s[11]||(s[11]=i=>w.value=i),questionDetail:m,quiz:l(r),"onUpdate:quiz":s[12]||(s[12]=i=>fe(r)?r.value=i:null),title:m.question?e.__("Edit the question"):e.__("Add a new question")},null,8,["modelValue","questionDetail","quiz","title"])],64)}}};export{ls as default};
