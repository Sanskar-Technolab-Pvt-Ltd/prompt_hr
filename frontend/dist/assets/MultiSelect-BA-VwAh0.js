import{D as j,E as P,r as d,a as x,bZ as U,y as I,d as m,e as n,j as F,f as o,L as M,n as X,t as k,F as S,v as $,h as B,m as f,g as v,k as i,b4 as Z,bR as K,be as q,_ as A,b9 as G,bf as H,b_ as J,b$ as Q,bg as W,c0 as Y,c1 as R,ag as ee}from"./index-OSkjyhkw.js";const te={key:0,class:"text-ink-red-3"},se={class:"grid grid-cols-3 gap-1"},ae={class:""},le={class:"mt-1 rounded-lg bg-surface-white py-1 text-base shadow-2xl"},oe={class:"flex flex-col gap-1 p-1"},ue={class:"text-base font-medium"},re={class:"text-sm text-ink-gray-5"},ie={__name:"MultiSelect",props:j({label:{type:String},size:{type:String,default:"sm"},doctype:{type:String,required:!0},filters:{type:Object,default:()=>({})},validate:{type:Function,default:null},errorMessage:{type:Function,default:u=>`${u} is an Invalid value`},required:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u,{expose:D}){const r=u,l=P(u,"modelValue"),p=d([]),w=d(null),h=d(null),c=d(""),y=d(""),b=d(!1),_=x({get:()=>c.value||"",set:e=>{c.value="",e&&(b.value=!1),e!=null&&e.value&&O(e.value)}});U(c,e=>{e=e||"",y.value!==e&&(y.value=e,N(e))},{debounce:300,immediate:!0});const g=I({url:"frappe.desk.search.search_link",method:"POST",cache:[y.value,r.doctype],auto:!0,params:{txt:y.value,doctype:r.doctype}}),E=x(()=>g.data||[]);function N(e){g.update({params:{txt:e,doctype:r.doctype}}),g.reload()}const O=e=>{h.value=null,e&&(e.split(",").forEach(t=>{var a;if(t=t.trim(),t&&!((a=l.value)!=null&&a.includes(t))){if(t&&r.validate&&!r.validate(t)){h.value=r.errorMessage(t);return}l.value?l.value.push(t):l.value=[t],t=t.replace(t,"")}}),!h.value&&(e=""))},z=e=>{l.value=l.value.filter(s=>s!==e)},V=()=>{var s;if(c.value)return;let e=(s=p.value[p.value.length-1])==null?void 0:s.$el;document.activeElement===e?(l.value.pop(),ee(()=>{l.value.length?(e=p.value[p.value.length-1].$el,e==null||e.focus()):C()})):e==null||e.focus()};function C(){w.value.$el.focus()}D({setFocus:C});const L=x(()=>[{sm:"text-xs",md:"text-base"}[r.size||"sm"],"text-ink-gray-5"]);return(e,s)=>(n(),m("div",null,[u.label?(n(),m("label",{key:0,class:M(["block mb-1",L.value])},[X(k(u.label)+" ",1),u.required?(n(),m("span",te,"*")):F("",!0)],2)):F("",!0),o("div",se,[(n(!0),m(S,null,$(l.value,t=>(n(),B(i(A),{ref_for:!0,ref_key:"emails",ref:p,key:t,label:t,theme:"gray",variant:"subtle",class:"rounded-md",onKeydownCapture:K(q(V,["stop"]),["delete"])},{suffix:f(()=>[v(i(Z),{onClick:a=>z(t),class:"h-4 w-4 stroke-1.5"},null,8,["onClick"])]),_:2},1032,["label","onKeydownCapture"]))),128)),o("div",ae,[v(i(R),{modelValue:_.value,"onUpdate:modelValue":s[2]||(s[2]=t=>_.value=t),nullable:""},{default:f(()=>[v(i(G),{class:"w-full",show:b.value,"onUpdate:show":s[1]||(s[1]=t=>b.value=t)},{target:f(({togglePopover:t})=>[v(i(Y),{ref_key:"search",ref:w,class:"search-input form-input w-full focus-visible:!ring-0",type:"text",value:c.value,onChange:s[0]||(s[0]=a=>{c.value=a.target.value,b.value=!0}),autocomplete:"off",onFocus:()=>t(),onKeydownCapture:K(q(V,["stop"]),["delete"])},null,8,["value","onFocus","onKeydownCapture"])]),body:f(({isOpen:t})=>[H(o("div",null,[o("div",le,[v(i(J),{class:"my-1 max-h-[12rem] overflow-y-auto px-1.5",static:""},{default:f(()=>[(n(!0),m(S,null,$(E.value,a=>(n(),B(i(Q),{key:a.value,value:a},{default:f(({active:T})=>[o("li",{class:M(["flex cursor-pointer items-center rounded px-2 py-1 text-base",{"bg-surface-gray-2":T}])},[o("div",oe,[o("div",ue,k(a.description),1),o("div",re,k(a.value),1)])],2)]),_:2},1032,["value"]))),128))]),_:1})])],512),[[W,t]])]),_:1},8,["show"])]),_:1},8,["modelValue"])])])]))}};export{ie as _};
