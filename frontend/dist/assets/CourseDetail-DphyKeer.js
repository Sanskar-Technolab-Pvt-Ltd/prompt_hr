import{x as G,i as O,a as V,y as $,b as j,d as u,e as o,j as f,f as a,h as b,t as n,g as i,m as v,k as e,_ as x,n as M,B as F,U as q,z as H,S as L,G as P,A as U,C as W,D as Y,E as S,H as J,I as K,J as Q,K as X,r as Z,F as C,v as N,L as I,M as B,s as ee,u as te,N as E,O as se}from"./index-OSkjyhkw.js";import{_ as ae}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DdVHL6EX.js";import{_ as re}from"./CertificationLinks-DdhAtx8x.js";import{_ as oe}from"./CourseOutline-CnQHw0kq.js";import{_ as A}from"./UserAvatar-CL8ZQPT_.js";import{_ as ne}from"./Rating-9E_QJqFe.js";import{_ as ie}from"./CourseInstructors-DK5TxlK3.js";import"./vuedraggable.umd-Qkpg2qlG.js";const le={class:"border-2 rounded-md min-w-80"},ue=["src"],ce={class:"p-5"},de={key:0,class:"text-2xl font-semibold mb-3"},me={key:1,class:"space-y-2"},_e={key:3,class:"bg-surface-blue-2 text-blue-900 text-sm rounded-md py-1 px-3"},fe={class:"space-y-4"},ve={class:"mt-8 font-medium text-ink-gray-9"},he={class:"flex items-center text-ink-gray-9"},pe={class:"ml-2"},ge={class:"flex items-center text-ink-gray-9"},we={class:"ml-2"},be={key:0,class:"flex items-center text-ink-gray-9"},ye={class:"ml-2"},ke={key:1,class:"flex items-center font-semibold text-ink-gray-9"},xe={class:"ml-2"},$e={key:2,class:"flex items-center font-semibold text-ink-gray-9"},Re={class:"ml-2"},T={__name:"CourseCardOverlay",props:{course:{type:Object,default:null}},setup(r){const k=G(),_=O("$user"),t=r,c=V(()=>t.course.data.video_link?"https://www.youtube.com/embed/"+t.course.data.video_link:null);function m(){_.data?$({url:"lms.lms.doctype.lms_enrollment.lms_enrollment.create_membership"}).submit({course:t.course.data.name}).then(()=>{W("enrolled_in_course",{course:t.course.data.name}),U(__("Success"),__("You have been enrolled in this course"),"check"),setTimeout(()=>{k.push({name:"Lesson",params:{courseName:t.course.data.name,chapterNumber:1,lessonNumber:1}})},2e3)}):(U(__("Please Login"),__("You need to login first to enroll for this course"),"alert-circle"),setTimeout(()=>{window.location.href=`/login?redirect-to=${window.location.pathname}`},2e3))}const y=()=>{let s=!1;return t.course.data.instructors.forEach(l=>{var w;!s&&l.name==((w=_.data)==null?void 0:w.name)&&(s=!0)}),s},p=V(()=>{var s,l,w;return!!((s=t.course.data)!=null&&s.enable_certification&&((w=(l=t.course.data)==null?void 0:l.membership)==null?void 0:w.progress)==100)}),g=$({url:"lms.lms.doctype.lms_certificate.lms_certificate.create_certificate",makeParams(s){return{course:s.course}},onSuccess(s){window.open(`/api/method/frappe.utils.print_format.download_pdf?doctype=LMS+Certificate&name=${s.name}&format=${encodeURIComponent(s.template)}`,"_blank")}}),h=()=>{var s,l;g.submit({course:(s=t.course.data)==null?void 0:s.name,member:(l=_.data)==null?void 0:l.name})};return(s,l)=>{var R,d;const w=j("router-link");return o(),u("div",le,[r.course.data.video_link?(o(),u("iframe",{key:0,src:c.value,class:"rounded-t-md min-h-56 w-full"},null,8,ue)):f("",!0),a("div",ce,[r.course.data.paid_course?(o(),u("div",de,n(r.course.data.price),1)):f("",!0),r.course.data.membership?(o(),u("div",me,[i(w,{to:{name:"Lesson",params:{courseName:r.course.name,chapterNumber:r.course.data.current_lesson?r.course.data.current_lesson.split("-")[0]:1,lessonNumber:r.course.data.current_lesson?r.course.data.current_lesson.split("-")[1]:1}}},{default:v(()=>[i(e(x),{variant:"solid",size:"md",class:"w-full"},{default:v(()=>[a("span",null,n(s.__("Continue Learning")),1)]),_:1})]),_:1},8,["to"]),i(re,{courseName:r.course.data.name,class:"w-full"},null,8,["courseName"])])):r.course.data.paid_course?(o(),b(w,{key:2,to:{name:"Billing",params:{type:"course",name:r.course.data.name}}},{default:v(()=>[i(e(x),{variant:"solid",size:"md",class:"w-full"},{default:v(()=>[a("span",null,n(s.__("Buy this course")),1)]),_:1})]),_:1},8,["to"])):r.course.data.disable_self_learning?(o(),u("div",_e,n(s.__("Contact the Administrator to enroll for this course.")),1)):(o(),b(e(x),{key:4,onClick:l[0]||(l[0]=z=>m()),variant:"solid",class:"w-full",size:"md"},{default:v(()=>[a("span",null,n(s.__("Start Learning")),1)]),_:1})),p.value?(o(),b(e(x),{key:5,onClick:l[1]||(l[1]=z=>h()),variant:"subtle",class:"w-full mt-2",size:"md"},{default:v(()=>[M(n(s.__("Get Certificate")),1)]),_:1})):f("",!0),(d=(R=e(_))==null?void 0:R.data)!=null&&d.is_moderator||y()?(o(),b(w,{key:6,to:{name:"CourseForm",params:{courseName:r.course.data.name}}},{default:v(()=>[i(e(x),{variant:"subtle",class:"w-full mt-2",size:"md"},{default:v(()=>[a("span",null,n(s.__("Edit")),1)]),_:1})]),_:1},8,["to"])):f("",!0),a("div",fe,[a("div",ve,n(s.__("This course has:")),1),a("div",he,[i(e(F),{class:"h-4 w-4 stroke-1.5"}),a("span",pe,n(r.course.data.lessons)+" "+n(s.__("Lessons")),1)]),a("div",ge,[i(e(q),{class:"h-4 w-4 stroke-1.5"}),a("span",we,n(e(H)(r.course.data.enrollments))+" "+n(s.__("Enrolled Students")),1)]),parseInt(r.course.data.rating)>0?(o(),u("div",be,[i(e(L),{class:"h-4 w-4 stroke-1.5 fill-orange-500 text-gray-50"}),a("span",ye,n(r.course.data.rating)+" "+n(s.__("Rating")),1)])):f("",!0),r.course.data.enable_certification?(o(),u("div",ke,[i(e(P),{class:"h-4 w-4 stroke-2"}),a("span",xe,n(s.__("Certificate of Completion")),1)])):f("",!0),r.course.data.paid_certificate?(o(),u("div",$e,[i(e(P),{class:"h-4 w-4 stroke-2"}),a("span",Re,n(s.__("Paid Certificate after Evaluation")),1)])):f("",!0)])])])}}},Ce={class:"flex flex-col gap-4"},Ne={class:"mb-1.5 text-sm text-ink-gray-5"},Se={class:"mb-1.5 text-sm text-ink-gray-5"},Ve={__name:"ReviewModal",props:Y({courseName:{type:String,required:!0}},{modelValue:{},modelModifiers:{},reloadReviews:{},reloadReviewsModifiers:{},hasReviewed:{},hasReviewedModifiers:{}}),emits:["update:modelValue","update:reloadReviews","update:hasReviewed"],setup(r){const k=S(r,"modelValue"),_=S(r,"reloadReviews"),t=S(r,"hasReviewed");let c=J({review:"",rating:0});const m=r,y=$({url:"frappe.client.insert",makeParams(g){return{doc:{doctype:"LMS Course Review",course:m.courseName,...g}}}});function p(g){c.rating=c.rating/5,y.submit(c,{validate(){if(!c.rating)return"Please enter a rating."},onSuccess(){_.value.reload(),t.value.reload()},onError(h){var s;X({text:((s=h.messages)==null?void 0:s[0])||h,icon:"x",iconClasses:"text-ink-red-4 bg-surface-red-4"})}}),g()}return(g,h)=>(o(),b(e(Q),{modelValue:k.value,"onUpdate:modelValue":h[2]||(h[2]=s=>k.value=s),options:{title:g.__("Write a Review"),size:"xl",actions:[{label:"Submit",variant:"solid",onClick:s=>p(s)}]}},{"body-content":v(()=>[a("div",Ce,[a("div",null,[a("div",Ne,n(g.__("Rating")),1),i(ne,{modelValue:e(c).rating,"onUpdate:modelValue":h[0]||(h[0]=s=>e(c).rating=s)},null,8,["modelValue"])]),a("div",null,[a("div",Se,n(g.__("Review")),1),i(e(K),{type:"text",size:"md",rows:"5",modelValue:e(c).review,"onUpdate:modelValue":h[1]||(h[1]=s=>e(c).review=s)},null,8,["modelValue"])])])]),_:1},8,["modelValue","options"]))}},Me={key:0,class:"mt-20 mb-10"},Le={class:"flex items-center font-semibold text-2xl text-ink-gray-9"},ze={class:"grid gap-8 mt-10"},Pe={class:"flex items-center"},Ue={class:"mx-4"},Be={class:"text-lg font-medium mr-4 text-ink-gray-7"},Ee={class:"text-ink-gray-7"},Te={class:"flex mt-2"},Oe={key:0,class:"mt-4 leading-5 text-ink-gray-7"},je={__name:"CourseReviews",props:{courseName:{type:String,required:!0},avg_rating:{type:String,required:!0},membership:{type:Object,required:!1}},setup(r){var p,g,h;const k=O("$user"),_=r,t=$({url:"frappe.client.get_count",cache:["eligible_to_review",_.courseName,(p=_.membership)==null?void 0:p.member],params:{doctype:"LMS Course Review",filters:{course:_.courseName,owner:(g=_.membership)==null?void 0:g.member}},auto:!!((h=k.data)!=null&&h.name)}),c=$({url:"lms.lms.utils.get_reviews",cache:["course_reviews",_.courseName],params:{course:_.courseName},auto:!0}),m=Z(!1);function y(){m.value=!0}return(s,l)=>{var R;const w=j("router-link");return o(),u(C,null,[(R=e(c).data)!=null&&R.length||r.membership?(o(),u("div",Me,[r.membership&&!e(t).data?(o(),b(e(x),{key:0,onClick:l[0]||(l[0]=d=>y()),class:"float-right"},{default:v(()=>[M(n(s.__("Write a Review")),1)]),_:1})):f("",!0),a("div",Le,n(s.__("Student Reviews")),1),a("div",ze,[(o(!0),u(C,null,N(e(c).data,(d,z)=>(o(),u("div",null,[a("div",Pe,[i(w,{to:{name:"Profile",params:{username:d.owner_details.username}}},{default:v(()=>[i(A,{user:d.owner_details,size:"2xl"},null,8,["user"])]),_:2},1032,["to"]),a("div",Ue,[i(w,{to:{name:"Profile",params:{username:d.owner_details.username}}},{default:v(()=>[a("span",Be,n(d.owner_details.full_name),1)]),_:2},1032,["to"]),a("span",Ee,n(d.creation),1),a("div",Te,[(o(),u(C,null,N(5,D=>i(e(L),{class:I(["h-5 w-5 text-ink-gray-1 rounded-sm mr-2",D<=Math.ceil(d.rating)?"fill-orange-500":"fill-gray-600"])},null,8,["class"])),64))])])]),d.review?(o(),u("div",Oe,n(d.review),1)):f("",!0)]))),256))])])):f("",!0),i(Ve,{modelValue:m.value,"onUpdate:modelValue":l[1]||(l[1]=d=>m.value=d),reloadReviews:e(c),"onUpdate:reloadReviews":l[2]||(l[2]=d=>B(c)?c.value=d:null),hasReviewed:e(t),"onUpdate:hasReviewed":l[3]||(l[3]=d=>B(t)?t.value=d:null),courseName:r.courseName},null,8,["modelValue","reloadReviews","hasReviewed","courseName"])],64)}}},qe={key:0},Ie={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ae={class:"m-5"},De={class:"flex justify-between w-full"},Ge={class:"md:w-2/3"},Fe={class:"text-3xl font-semibold text-ink-gray-9"},He={class:"my-3 leading-6 text-ink-gray-7"},We={class:"flex items-center"},Ye={class:"ml-1 text-ink-gray-7"},Je={key:1,class:"mx-3"},Ke={class:"ml-1"},Qe={key:3,class:"mx-3"},Xe={class:"flex items-center"},Ze={key:0,class:"flex mt-4 w-fit"},et=["innerHTML"],tt={class:"mt-10"},st={class:"hidden md:block"},dt={__name:"CourseDetail",props:{courseName:{type:String,required:!0}},setup(r){const{brand:k}=ee(),_=r,t=$({url:"lms.lms.utils.get_course_details",cache:["course",_.courseName],params:{course:_.courseName},auto:!0}),c=V(()=>{var y,p;let m=[{label:"Courses",route:{name:"Courses"}}];return m.push({label:(y=t==null?void 0:t.data)==null?void 0:y.title,route:{name:"CourseDetail",params:{courseName:(p=t==null?void 0:t.data)==null?void 0:p.name}}}),m});return te(()=>{var m;return{title:(m=t==null?void 0:t.data)==null?void 0:m.title,icon:k.favicon}}),(m,y)=>e(t).data?(o(),u("div",qe,[a("header",Ie,[i(e(ae),{class:"h-7",items:c.value},null,8,["items"])]),a("div",Ae,[a("div",De,[a("div",Ge,[a("div",Fe,n(e(t).data.title),1),a("div",He,n(e(t).data.short_introduction),1),a("div",We,[parseInt(e(t).data.rating)>0?(o(),b(e(E),{key:0,text:m.__("Average Rating"),class:"flex items-center"},{default:v(()=>[i(e(L),{class:"h-5 w-5 text-gray-100 fill-orange-500"}),a("span",Ye,n(e(t).data.rating),1)]),_:1},8,["text"])):f("",!0),parseInt(e(t).data.rating)>0?(o(),u("span",Je,"·")):f("",!0),e(t).data.enrollment_count?(o(),b(e(E),{key:2,text:m.__("Enrolled Students"),class:"flex items-center"},{default:v(()=>[i(e(q),{class:"h-4 w-4 text-ink-gray-7"}),a("span",Ke,n(e(t).data.enrollment_count_formatted),1)]),_:1},8,["text"])):f("",!0),e(t).data.enrollment_count?(o(),u("span",Qe,"·")):f("",!0),a("div",Xe,[a("span",{class:I(["h-6 mr-1",{"avatar-group overlap":e(t).data.instructors.length>1}])},[(o(!0),u(C,null,N(e(t).data.instructors,p=>(o(),b(A,{user:p},null,8,["user"]))),256))],2),i(ie,{instructors:e(t).data.instructors},null,8,["instructors"])])]),e(t).data.tags?(o(),u("div",Ze,[(o(!0),u(C,null,N(e(t).data.tags.split(", "),p=>(o(),b(e(se),{theme:"gray",size:"lg",class:"mr-2 text-ink-gray-9"},{default:v(()=>[M(n(p),1)]),_:2},1024))),256))])):f("",!0),i(T,{course:e(t),class:"md:hidden mb-4"},null,8,["course"]),a("div",{innerHTML:e(t).data.description,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal mt-4"},null,8,et),a("div",tt,[i(oe,{title:m.__("Course Outline"),courseName:e(t).data.name,showOutline:!0},null,8,["title","courseName"])]),i(je,{courseName:e(t).data.name,avg_rating:e(t).data.rating,membership:e(t).data.membership},null,8,["courseName","avg_rating","membership"])]),a("div",st,[i(T,{course:e(t)},null,8,["course"])])])])])):f("",!0)}};export{dt as default};
