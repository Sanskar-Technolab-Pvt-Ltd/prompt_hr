import{s as H,r as h,x as K,a0 as Q,a as V,u as W,d as p,e as n,f as d,j as C,g as l,k as s,m as t,n as x,t as g,_ as f,p as X,P as M,F as P,v as S,h as b,ac as T,aa as D,J as Z,Y as ee,A as c}from"./index-OSkjyhkw.js";import{_ as se}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DdVHL6EX.js";import{_ as F,a as A,b as U,c as j,e as B,f as I}from"./ListView-yKC6cFSr.js";import{D as re}from"./vuedraggable.umd-Qkpg2qlG.js";const ae={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},oe={key:0,class:"pt-5 px-5 w-3/4 mx-auto space-y-10"},le={class:"flex items-center justify-between mb-2"},te={class:"text-lg font-semibold"},me={class:"flex gap-2"},ue={class:"flex items-center justify-between mb-2"},ne={class:"text-lg font-semibold"},de={class:"flex gap-2"},ge={__name:"ProgramForm",props:{programName:{type:String,required:!0}},setup(L){const{brand:O}=H(),i=h(!1),_=h(null),v=h(null),w=h(null),R=K(),k=L,o=Q({doctype:"LMS Program",name:k.programName,auto:!0,cache:["program",k.programName]}),q=()=>{o.setValue.submit({program_courses:[...o.doc.program_courses,{course:v.value}]},{onSuccess(e){i.value=!1,v.value=null,c(__("Success"),__("Course added to program"),"check"),o.reload()},onError(e){var a;c("Error",((a=e.messages)==null?void 0:a[0])||e,"x")}})},z=()=>{o.setValue.submit({program_members:[...o.doc.program_members,{member:w.value}]},{onSuccess(e){i.value=!1,w.value=null,c(__("Success"),__("Member added to program"),"check"),o.reload()},onError(e){var a;c("Error",((a=e.messages)==null?void 0:a[0])||e,"x")}})},N=(e,a,r)=>{e=Array.from(e),o.setValue.submit({[r]:o.doc[r].filter(m=>!e.includes(m.name))},{onSuccess(m){a(),c(__("Success"),__("Items removed successfully"),"check"),o.reload()},onError(m){var u;c("Error",((u=m.messages)==null?void 0:u[0])||m,"x")}})},J=e=>{let a=e.from.dataset.idx,r=e.to.dataset.idx,m=o.doc.program_courses;m.splice(r,0,m.splice(a,1)[0]),m.forEach((u,y)=>{u.idx=y+1}),o.setValue.submit({program_courses:m},{onSuccess(u){c(__("Success"),__("Course moved successfully"),"check"),o.reload()},onError(u){var y;c("Error",((y=u.messages)==null?void 0:y[0])||u,"x")}})},Y=()=>{ee("frappe.model.rename_doc.update_document_title",{doctype:"LMS Program",docname:o.doc.name,name:o.doc.title}).then(e=>{R.push({name:"ProgramForm",params:{programName:e}})})},$=V(()=>[{label:"Title",key:"course_title",width:3},{label:"ID",key:"course",width:3}]),E=V(()=>[{label:"Member",key:"member",width:3,align:"left"},{label:"Full Name",key:"full_name",width:3,align:"left"},{label:"Progress (%)",key:"progress",width:3,align:"right"}]),G=V(()=>[{label:"Programs",route:{name:"Programs"}},{label:k.programName==="new"?"New Program":k.programName}]);return W(()=>{var e;return{title:(e=o.doc)==null?void 0:e.title,icon:O.favicon}}),(e,a)=>(n(),p(P,null,[d("header",ae,[l(s(se),{items:G.value},null,8,["items"]),l(s(f),{variant:"solid",onClick:a[0]||(a[0]=r=>Y())},{default:t(()=>[x(g(e.__("Save")),1)]),_:1})]),s(o).doc?(n(),p("div",oe,[l(s(X),{modelValue:s(o).doc.title,"onUpdate:modelValue":a[1]||(a[1]=r=>s(o).doc.title=r),label:e.__("Title")},null,8,["modelValue","label"]),d("div",null,[d("div",le,[d("div",te,g(e.__("Program Courses")),1),l(s(f),{onClick:a[2]||(a[2]=()=>{_.value="course",i.value=!0})},{prefix:t(()=>[l(s(M),{class:"w-4 h-4"})]),default:t(()=>[x(" "+g(e.__("Add")),1)]),_:1})]),l(s(I),{columns:$.value,rows:s(o).doc.program_courses,"row-key":"name",options:{showTooltip:!1}},{default:t(()=>[l(s(F),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:t(()=>[(n(!0),p(P,null,S($.value,r=>(n(),b(s(A),{item:r},null,8,["item"]))),256))]),_:1}),l(s(U),null,{default:t(()=>[l(s(re),{list:s(o).doc.program_courses,"item-key":"name",group:"items",onEnd:J,class:"cursor-move"},{item:t(({element:r})=>[l(s(j),{row:r},null,8,["row"])]),_:1},8,["list"])]),_:1}),l(s(B),null,{actions:t(({unselectAll:r,selections:m})=>[d("div",me,[l(s(f),{variant:"ghost",onClick:u=>N(m,r,"program_courses")},{default:t(()=>[l(s(T),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])]),d("div",null,[d("div",ue,[d("div",ne,g(e.__("Program Members")),1),l(s(f),{onClick:a[3]||(a[3]=()=>{_.value="member",i.value=!0})},{prefix:t(()=>[l(s(M),{class:"w-4 h-4"})]),default:t(()=>[x(" "+g(e.__("Add")),1)]),_:1})]),l(s(I),{columns:E.value,rows:s(o).doc.program_members,"row-key":"name",options:{showTooltip:!1}},{default:t(()=>[l(s(F),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:t(()=>[(n(!0),p(P,null,S(E.value,r=>(n(),b(s(A),{item:r},null,8,["item"]))),256))]),_:1}),l(s(U),null,{default:t(()=>[(n(!0),p(P,null,S(s(o).doc.program_members,r=>(n(),b(s(j),{row:r},null,8,["row"]))),256))]),_:1}),l(s(B),null,{actions:t(({unselectAll:r,selections:m})=>[d("div",de,[l(s(f),{variant:"ghost",onClick:u=>N(m,r,"program_members")},{default:t(()=>[l(s(T),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])])])):C("",!0),l(s(Z),{modelValue:i.value,"onUpdate:modelValue":a[6]||(a[6]=r=>i.value=r),options:{title:_.value=="course"?e.__("New Program Course"):e.__("New Program Member"),actions:[{label:e.__("Add"),variant:"solid",onClick:()=>_.value=="course"?q(e.close):z(e.close)}]}},{"body-content":t(()=>[_.value=="course"?(n(),b(D,{key:0,modelValue:v.value,"onUpdate:modelValue":a[4]||(a[4]=r=>v.value=r),doctype:"LMS Course",filters:{disable_self_learning:1},label:e.__("Program Course"),description:e.__("Only courses for which self learning is disabled can be added to program.")},null,8,["modelValue","label","description"])):C("",!0),_.value=="member"?(n(),b(D,{key:1,modelValue:w.value,"onUpdate:modelValue":a[5]||(a[5]=r=>w.value=r),doctype:"User",filters:{ignore_user_type:1},label:e.__("Program Member")},null,8,["modelValue","label"])):C("",!0)]),_:1},8,["modelValue","options"])],64))}};export{ge as default};
