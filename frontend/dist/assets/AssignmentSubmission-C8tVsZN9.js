import{r as N,x as le,i as K,o as Y,V as ue,y as A,a0 as me,A as T,w as j,Y as de,a as D,d as c,j as _,k as a,e as r,f as n,t as o,L as B,h as x,g as p,m as S,n as F,O,_ as q,b1 as ce,b2 as fe,b3 as be,b4 as ge,p as z,aw as H,s as ve,u as _e,F as pe}from"./index-OSkjyhkw.js";import{_ as ye}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DdVHL6EX.js";const he={key:0,class:"text-lg font-semibold mb-5 text-ink-gray-9"},we={key:0},ke={key:1},xe={class:"text-sm text-ink-gray-7 font-medium mb-2"},Se=["innerHTML"],Ne={class:"flex flex-col"},De={class:"p-5"},Le={class:"flex items-center justify-between mb-4"},Te={class:"font-semibold text-ink-gray-9"},Fe={class:"flex items-center space-x-2"},Ae={key:0,class:"bg-surface-blue-2 text-ink-blue-2 p-3 rounded-md leading-5 text-sm mb-4"},Ie={key:1},Ce={class:"text-xs text-ink-gray-5 mt-1 mb-2"},Re={key:1},Me={class:"flex text-ink-gray-7"},Pe={class:"border self-start rounded-md p-2 mr-2"},Ve=["href"],$e={class:"text-sm leading-5"},Ee={class:"text-sm text-ink-gray-5 mt-1"},Ue={key:2},Ge={class:"text-xs text-ink-gray-5 mb-1"},je={key:3},Be={class:"text-sm mb-2 text-ink-gray-7"},Oe={key:4,class:"mt-8 p-3 bg-surface-blue-2 rounded-md"},qe={class:"text-sm text-ink-gray-5 font-medium mb-2"},ze=["innerHTML"],He={key:5,class:"mt-8 space-y-4"},Ke={class:"font-semibold mb-2 text-ink-gray-9"},Ye={class:"text-sm text-ink-gray-5 mb-1"},Qe={__name:"Assignment",props:{assignmentID:{type:String,required:!0},submissionName:{type:String,default:"new"},showTitle:{type:Boolean,default:!0}},setup(v){var M;const u=N(null),f=N(null),w=N(null),b=le(),m=K("$user"),g=N(!1),d=v;Y(()=>{window.addEventListener("keydown",k)});const k=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&(C(),e.preventDefault())};ue(()=>{window.removeEventListener("keydown",k)});const y=A({url:"frappe.client.get",params:{doctype:"LMS Assignment",name:d.assignmentID},auto:!0,onSuccess(e){d.submissionName!="new"&&t.reload()}}),Q=A({url:"frappe.client.insert",makeParams(e){var i;let s={doctype:"LMS Assignment Submission",assignment:d.assignmentID,member:(i=m.data)==null?void 0:i.name};return L()?s.assignment_attachment=u.value.file_url:s.answer=f.value,{doc:s}}}),W=A({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){u.value=e}}),t=me({doctype:"LMS Assignment Submission",name:d.submissionName,onError(e){var s;T(__("Error"),__(((s=e.messages)==null?void 0:s[0])||e),"x")},auto:!1,cache:[(M=m.data)==null?void 0:M.name,d.assignmentID]});j(t,()=>{t.doc&&(t.doc.assignment_attachment&&W.reload({image:t.doc.assignment_attachment}),t.doc.answer&&(f.value=t.doc.answer),t.doc.comments&&(w.value=t.doc.comments),t.isDirty||L()&&!u.value||!L()&&!f.value?g.value=!0:g.value=!1)}),j(u,()=>{d.submissionName=="new"&&u.value&&(g.value=!0)});const C=()=>{var e,s,i;if(d.submissionName!="new"){let h=t.doc&&t.doc.owner!=((e=m.data)==null?void 0:e.name)?(s=m.data)==null?void 0:s.name:null;t.setValue.submit({...t.doc,assignment_attachment:(i=u.value)==null?void 0:i.file_url,evaluator:h,comments:w.value,answer:f.value},{onSuccess(I){T(__("Success"),__("Changes saved successfully"),"check")}})}else X()},X=()=>{Q.submit({},{onSuccess(e){T("Success","Assignment submitted successfully.","check"),b.currentRoute.value.name=="AssignmentSubmission"?b.push({name:"AssignmentSubmission",params:{assignmentID:d.assignmentID,submissionName:e.name},query:{fromLesson:b.currentRoute.value.query.fromLesson}}):(Z(),b.go()),t.name=e.name,t.reload()},onError(e){var s;T("Error",((s=e.messages)==null?void 0:s[0])||e,"x")}})},J=e=>{g.value=!0,u.value=e},Z=()=>{if(b.currentRoute.value.name=="Lesson"){let e=b.currentRoute.value.params.courseName,s=b.currentRoute.value.params.chapterNumber,i=b.currentRoute.value.params.lessonNumber;de("lms.lms.api.mark_lesson_progress",{course:e,chapter_number:s,lesson_number:i})}},ee=()=>{var s;const e=(s=y.data)==null?void 0:s.type;if(e=="Image")return["image/*"];if(e=="Document")return[".doc",".docx",".xml","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(e=="PDF")return[".pdf"]},se=e=>{var h;let s=(h=y.data)==null?void 0:h.type,i=e.name.split(".").pop().toLowerCase();if(s=="Image"&&!["jpg","jpeg","png"].includes(i))return"Only image file is allowed.";if(s=="Document"&&!["doc","docx","xml"].includes(i))return"Only document file is allowed.";if(s=="PDF"&&!["pdf"].includes(i))return"Only PDF file is allowed."},te=()=>{g.value=!0,u.value=null},ae=D(()=>{var e,s,i;return(((e=m.data)==null?void 0:e.is_moderator)||((s=m.data)==null?void 0:s.is_evaluator)||((i=m.data)==null?void 0:i.is_instructor))&&d.submissionName!="new"&&b.currentRoute.value.name=="AssignmentSubmission"}),R=D(()=>{var e,s,i;return!t.doc||((e=t.doc)==null?void 0:e.owner)==((s=m.data)==null?void 0:s.name)&&((i=t.doc)==null?void 0:i.status)=="Not Graded"}),ne=D(()=>[{label:"Not Graded",value:"Not Graded"},{label:"Pass",value:"Pass"},{label:"Fail",value:"Fail"}]),oe=D(()=>t.doc?t.doc.status=="Pass"?"green":t.doc.status=="Not Graded"?"blue":"red":"orange"),L=()=>{var e;return["PDF","Image","Document"].includes((e=y.data)==null?void 0:e.type)};return(e,s)=>{var i,h,I,P,V,$,E,U,G;return a(y).data?(r(),c("div",{key:0,class:B(["grid grid-cols-2 h-full",{"border rounded-lg overflow-auto":!v.showTitle}])},[n("div",{class:B(["border-r p-5 overflow-y-auto h-[calc(100vh-3.2rem)]",{"h-full":!v.showTitle}])},[v.showTitle?(r(),c("div",he,[v.submissionName==="new"?(r(),c("div",we,o(e.__("Submission by"))+" "+o((i=a(m).data)==null?void 0:i.full_name),1)):(r(),c("div",ke,o(e.__("Submission by"))+" "+o((h=a(t).doc)==null?void 0:h.member_name),1))])):_("",!0),n("div",xe,o(e.__("Question"))+": ",1),n("div",{innerHTML:a(y).data.question,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal"},null,8,Se)],2),n("div",Ne,[n("div",De,[n("div",Le,[n("div",Te,o(e.__("Submission")),1),n("div",Fe,[g.value?(r(),x(a(O),{key:0,theme:"orange"},{default:S(()=>[F(o(e.__("Not Saved")),1)]),_:1})):(I=a(t).doc)!=null&&I.status?(r(),x(a(O),{key:1,theme:oe.value,size:"lg"},{default:S(()=>{var l;return[F(o((l=a(t).doc)==null?void 0:l.status),1)]}),_:1},8,["theme"])):_("",!0),p(a(q),{variant:"solid",onClick:s[0]||(s[0]=l=>C())},{default:S(()=>[F(o(e.__("Save")),1)]),_:1})])]),v.submissionName!="new"&&!["Pass","Fail"].includes((P=a(t).doc)==null?void 0:P.status)&&((V=a(t).doc)==null?void 0:V.owner)==(($=a(m).data)==null?void 0:$.name)?(r(),c("div",Ae,o(e.__("You've successfully submitted the assignment."))+" "+o(e.__("Once the moderator grades your submission, you'll find the details here."))+" "+o(e.__("Feel free to make edits to your submission if needed.")),1)):_("",!0),L()?(r(),c("div",Ie,[n("div",Ce,o(e.__("Add your assignment as {0}").format(a(y).data.type)),1),u.value?(r(),c("div",Re,[n("div",Me,[n("div",Pe,[p(a(fe),{class:"h-5 w-5 stroke-1.5"})]),n("a",{href:u.value.file_url,target:"_blank",class:"flex flex-col cursor-pointer !no-underline"},[n("span",$e,o(u.value.file_name),1),n("span",Ee,o(a(be)(u.value.file_size)),1)],8,Ve),R.value?(r(),x(a(ge),{key:0,onClick:s[2]||(s[2]=l=>te()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})):_("",!0)])])):(r(),x(a(ce),{key:0,fileTypes:ee(),validateFile:se,onSuccess:s[1]||(s[1]=l=>J(l))},{default:S(({uploading:l,progress:ie,openFileSelector:re})=>[p(a(q),{onClick:re,loading:l},{default:S(()=>[F(o(l?e.__("Uploading {0}%").format(ie):e.__("Upload File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes"]))])):a(y).data.type=="URL"?(r(),c("div",Ue,[n("div",Ge,o(e.__("Enter a URL")),1),p(a(z),{modelValue:f.value,"onUpdate:modelValue":s[3]||(s[3]=l=>f.value=l),type:"text",readonly:!R.value},null,8,["modelValue","readonly"])])):(r(),c("div",je,[n("div",Be,o(e.__("Write your answer here")),1),p(a(H),{content:f.value,onChange:s[4]||(s[4]=l=>f.value=l),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),((E=a(m).data)==null?void 0:E.name)==((U=a(t).doc)==null?void 0:U.owner)&&((G=a(t).doc)!=null&&G.comments)?(r(),c("div",Oe,[n("div",qe,o(e.__("Comments by Evaluator"))+": ",1),n("div",{class:"leading-5 text-ink-gray-9",innerHTML:a(t).doc.comments},null,8,ze)])):_("",!0),ae.value?(r(),c("div",He,[n("div",Ke,o(e.__("Grading")),1),a(t).doc?(r(),x(a(z),{key:0,modelValue:a(t).doc.status,"onUpdate:modelValue":s[5]||(s[5]=l=>a(t).doc.status=l),label:e.__("Grade"),type:"select",options:ne.value},null,8,["modelValue","label","options"])):_("",!0),n("div",null,[n("div",Ye,o(e.__("Comments")),1),p(a(H),{content:w.value,onChange:s[6]||(s[6]=l=>{w.value=l,g.value=!0}),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])])):_("",!0)])])],2)):_("",!0)}}},We={key:0,class:"flex justify-between sticky top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},Xe={class:"overflow-hidden h-[calc(100vh-3.2rem)]"},es={__name:"AssignmentSubmission",props:{assignmentID:{type:String,required:!0},submissionName:{type:String,default:"new"}},setup(v){const u=K("$user"),f=N(!1),{brand:w}=ve(),b=v,m=A({url:"frappe.client.get_value",params:{doctype:"LMS Assignment",fieldname:"title",filters:{name:b.assignmentID}},auto:!0});Y(()=>{u.data||(window.location.href="/login"),new URLSearchParams(window.location.search).get("fromLesson")&&(f.value=!0)});const g=D(()=>{var k;return[{label:"Submissions",route:{name:"AssignmentSubmissionList"}},{label:(k=m.data)==null?void 0:k.title,route:{name:"AssignmentSubmission",params:{assignmentID:b.assignmentID}}}]});return _e(()=>{var d;return{title:(d=m.data)==null?void 0:d.title,icon:w.favicon}}),(d,k)=>(r(),c(pe,null,[f.value?_("",!0):(r(),c("header",We,[p(a(ye),{items:g.value},null,8,["items"])])),n("div",Xe,[p(Qe,{assignmentID:v.assignmentID,submissionName:v.submissionName,showTitle:!f.value},null,8,["assignmentID","submissionName","showTitle"])])],64))}};export{es as default};
